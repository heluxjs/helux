!(function(){"use strict";var tl=Object.defineProperty,nl=Object.defineProperties;var rl=Object.getOwnPropertyDescriptors;var _t=Object.getOwnPropertySymbols;var vs=Object.prototype.hasOwnProperty,Ss=Object.prototype.propertyIsEnumerable;var Es=(U,B,P)=>B in U?tl(U,B,{enumerable:!0,configurable:!0,writable:!0,value:P}):U[B]=P,M=(U,B)=>{for(var P in B||(B={}))vs.call(B,P)&&Es(U,P,B[P]);if(_t)for(var P of _t(B))Ss.call(B,P)&&Es(U,P,B[P]);return U},j=(U,B)=>nl(U,rl(B));var As=(U,B)=>{var P={};for(var b in U)vs.call(U,b)&&B.indexOf(b)<0&&(P[b]=U[b]);if(U!=null&&_t)for(var b of _t(U))B.indexOf(b)<0&&Ss.call(U,b)&&(P[b]=U[b]);return P};var Ks=(U,B,P)=>new Promise((b,z)=>{var Se=W=>{try{Ae(P.next(W))}catch(Z){z(Z)}},We=W=>{try{Ae(P.throw(W))}catch(Z){z(Z)}},Ae=W=>W.done?b(W.value):Promise.resolve(W.value).then(Se,We);Ae((P=P.apply(U,B)).next())});(self.webpackChunkhelux_docs=self.webpackChunkhelux_docs||[]).push([[3649],{73649:function(U,B,P){P.r(B),P.d(B,{$:function(){return Af},action:function(){return mf},addMiddleware:function(){return Qf},addPlugin:function(){return qf},atom:function(){return Ui},atomx:function(){return Bi},block:function(){return vf},createShared:function(){return Ni},cst:function(){return el},defineDeriveFnItem:function(){return $i},defineDeriveTask:function(){return Hi},defineMutateFnItem:function(){return Tf},derive:function(){return Gi},deriveDict:function(){return ji},dynamicBlock:function(){return Sf},emit:function(){return Ff},flush:function(){return xf},getActionLoading:function(){return Wf},getAtom:function(){return Zf},getDeriveLoading:function(){return Xf},getMutateLoading:function(){return $f},getRawState:function(){return zf},getSnap:function(){return Jf},init:function(){return Cf},isAtom:function(){return Lf},isDerivedAtom:function(){return Nf},isDerivedResult:function(){return Uf},isDiff:function(){return jf},isDraft:function(){return Bf},isSharedState:function(){return Pf},markRaw:function(){return Gf},model:function(){return wf},modelFactory:function(){return Mf},mutate:function(){return Kf},mutateDict:function(){return Df},on:function(){return kf},produce:function(){return Hf},reactiveDesc:function(){return Of},runDerive:function(){return Wi},runDeriveTask:function(){return Xi},runMutate:function(){return _f},runMutateTask:function(){return Rf},shallowCompare:function(){return Yf},share:function(){return Vi},sharex:function(){return Yi},signal:function(){return Ef},storeSrv:function(){return Vf},sync:function(){return bf},syncer:function(){return If},useActionLoading:function(){return ff},useAtom:function(){return Zi},useAtomX:function(){return Qi},useDerived:function(){return tf},useEffect:function(){return lf},useGlobalForceUpdate:function(){return gf},useGlobalId:function(){return of},useLayoutEffect:function(){return df},useLocalForceUpdate:function(){return hf},useMutable:function(){return af},useMutateLoading:function(){return uf},useObject:function(){return yf},useOnEvent:function(){return cf},useReactive:function(){return qi},useReactiveX:function(){return ef},useService:function(){return sf},useStable:function(){return pf},useWatch:function(){return nf},useWatchEffect:function(){return rf},watch:function(){return zi},watchEffect:function(){return Ji}});function b(e,t){e.includes(t)||e.push(t)}function z(e,t){const n=e.indexOf(t);n>=0&&e.splice(n,1)}function Se(e){return Array.from(new Set(e))}function We(e,t){let n=!1;for(const r of e)if(t.includes(r)){n=!0;break}return n}function Ae(e,t){let n="";const r=e.length;for(let o=0;o<r;o++){const s=e[o];if(t.startsWith(s)){n=s;break}}return n}function W(e,t,n){if(!e)return[];const r=e(t,n);return Array.isArray(r)?r:[r]}var Z=function(){if(typeof globalThis!="undefined")return globalThis;if(typeof global!="undefined")return global;if(typeof window!="undefined")return window;if(this!==void 0)return this;throw new Error("no globalThis")}(),Ln=!1;function F(...e){}var Ds=F;function _s(...e){return e}function Ke(...e){return[]}function ol(...e){}var Rs=Object.prototype.toString,Ts="[object Map]";function sl(){return Z.window===void 0&&Z.global!==void 0}function Rt(e){return Rs.call(e)===Ts}function Pn(e){return e===Number.MAX_SAFE_INTEGER}function ue(){return!(!Ln&&Z.name!=="previewFrame"&&!Z.BrowserFS)}function J(e){return e&&typeof e=="object"&&!Array.isArray(e)}function Nn(e){return e&&typeof e=="object"}function x(e){return typeof e=="function"}function cl(e){return Ln?Object.prototype.toString.call(e)==="[object AsyncFunction]":!0}function Tt(e){return typeof e=="symbol"}function bt(e){if(!e)return!1;const t=typeof e;return(t==="object"||t==="function")&&x(e.then)}function al(e){try{return e.test,!1}catch(t){return!0}}function we(){return typeof Proxy=="function"}function ie(e,t){const{throwErr:n=!1,prefixLabel:r="",suffixLabel:o=", see details in console.",logErr:s=!0,alertErr:c}=t||{};let a=e,u=!1;if(e instanceof Error&&(u=!0,a=e.message),(typeof c=="boolean"?c:ue())&&Z.alert&&e&&Z.alert(`${r}${a}${o}`),s&&console.error(e),n)throw u?e:new Error(String(e))}function De(e,t=0){t===0?(console.error(e),ue()&&console.trace(e)):t===1?console.error(e):console.warn(e)}function Me(e){return Pn(e)?1:e+1}var bs=!!Reflect,Is=Object.prototype.hasOwnProperty;function ws(e,t){return bs?Reflect.has(e,t):Is.call(e,t)}function Fe(e,t,n){let r=e[t];return r||(r=e[t]=n),r}function ke(e,t,n){let r=e.get(t);return r||(e.set(t,n),r=n),r}function Un(e,t){let n="";for(const r in e)if(t.startsWith(r)){n=r;break}return n}function Bn(e,t){const n=e.get(t);if(n!==void 0)return n;const r=e.get(Number(t)||t);return r!==void 0?r:void 0}function fe(e,t){let n,r=e;return t.forEach(o=>{n=Rt(r)?Bn(r,o):r[o],r=n}),n}function Vn(e,t,n){let r=e;const o=t.length-1;t.forEach((s,c)=>{const a=Rt(r);if(c===o)return void(a?r.set(s,n):r[s]=n);r=a?Bn(r,s):r[s]})}function Ms(){return De("changing shared state is invalid"),!0}function ul(e){return e}function It(e,t){return`${t}/${e}`}function wt(e){return e&&we()}var Fs=Object.defineProperty,Mt={};((e,t)=>{for(var n in t)Fs(e,n,{get:t[n],enumerable:!0})})(Mt,{useEffect:()=>xs,useEffectLogic:()=>kt,useForceUpdate:()=>Yn,useLayoutEffect:()=>Os,useObject:()=>Ps,useObjectLogic:()=>jn,useStable:()=>Gn});var ks=0,Xe=new Map,Ft=0;function Cs(e,t){const n=()=>{const r=t();return()=>{Xe.delete(e),r&&r()}};if(function(r){Ft||(Ft=r)}(e),function(r){const o=Xe.get(r);o?o.count+=1:Xe.set(r,{count:1})}(e),Ft%2!=0)return n();{const r=function(o){return Xe.get(o)}(e);if(r&&r.count>1)return n()}}function kt(e,t,n){const{useState:r,useLayoutEffect:o,useEffect:s}=e.react,{isLayout:c,deps:a}=n,[u]=r(()=>++ks);(c?o:s)(()=>Cs(u,t),a)}function Os(e,t,n){kt(e,t,{isLayout:!0,deps:n})}function xs(e,t,n){kt(e,t,{deps:n})}function Yn(e){const[,t]=e.react.useState({});return()=>t({})}function Ls(e){const{data:t}=e.current;x(t)?e.current.wrap=(...n)=>e.current.data(...n):J(t)?e.current.wrap=function(n,r){if(!we()){const s={};return Object.keys(n).forEach(c=>{const a=n[c];x(a)?s[c]=(...u)=>r.current.data[c](...u):Object.defineProperty(s,c,{get:()=>r.current.data[c],set(u){r.current.data[c]=u}})}),s}const o={};return new Proxy(n,{get(s,c){const a=s[c];return x(a)?Fe(o,c,(...u)=>r.current.data[c](...u)):a}})}(t,e):e.current.wrap=t}function Gn(e,t){const{useRef:n,useMemo:r}=e.react,o=n({data:t,wrap:{},inited:!1});return o.current.data=r(()=>t,[t]),o.current.inited||(Ls(o),o.current.inited=!0),o.current.wrap}function jn(e,t,n,r){const{useState:o,useRef:s,useEffect:c}=e.react,[a]=o(t),u=Yn(e),f=s({state:null,unmount:!1,shouldCopy:!0}),i=Gn(e,{setState(l){const d=f.current;if(d.unmount)return;let p;const{state:y}=d;n?(p=n(l,d.state||a),r&&p?(d.state=p,d.shouldCopy=!1):d.shouldCopy=!0):(p=(x(l)?l(y):l)||{},d.shouldCopy=!0),Object.assign(a,p||{}),u()},getLatestState(){const l=f.current;return l.shouldCopy&&(l.state=M({},a),l.shouldCopy=!1),l.state}});return c(()=>{const l=f.current;return l.unmount=!1,()=>{l.unmount=!0}},[f]),[a,i.setState,i]}function Ps(e,t){return jn(e,t)}function Ns(e){const t={},n={react:e},r=Mt;return Object.keys(Mt).forEach(o=>{t[o]=r[o].bind(null,n)}),t}var X=P(14861),Us=Object.defineProperty,Bs=(e,t)=>{for(var n in t)Us(e,n,{get:t[n],enumerable:!0})},Hn={};Bs(Hn,{$:()=>bi,action:()=>Do,addMiddleware:()=>uc,addPlugin:()=>dc,atom:()=>oi,atomx:()=>si,block:()=>Ki,createShared:()=>Ti,cst:()=>Ii,currentDraftRoot:()=>Bc,defineDeriveFnItem:()=>_u,defineDeriveTask:()=>Du,defineMutateFnItem:()=>Iu,derive:()=>bo,deriveDict:()=>Ku,dynamicBlock:()=>ys,emit:()=>gc,flush:()=>ln,getActionLoading:()=>Uu,getAtom:()=>tr,getDeriveLoading:()=>eu,getMutateLoading:()=>Pu,getRawState:()=>Dc,getSnap:()=>gr,init:()=>ac,isAtom:()=>Te,isDerivedAtom:()=>le,isDerivedResult:()=>ec,isDiff:()=>_i,isDraft:()=>Ri,isSharedState:()=>qs,markRaw:()=>X.Xl,mutate:()=>ko,mutateDict:()=>Tn,on:()=>mc,produce:()=>X.Uy,reactiveDesc:()=>Vr,runDerive:()=>Ja,runDeriveTask:()=>Za,runMutate:()=>Mo,runMutateTask:()=>Fo,shallowCompare:()=>Di,share:()=>os,sharex:()=>ss,signal:()=>hs,storeSrv:()=>ju,sync:()=>ci,syncer:()=>ai,useActionLoading:()=>Bu,useAtom:()=>Co,useAtomX:()=>Oo,useDerived:()=>In,useGlobalForceUpdate:()=>No,useGlobalId:()=>Lu,useLocalForceUpdate:()=>Yo,useMutable:()=>Go,useMutateLoading:()=>Nu,useOnEvent:()=>Vu,useReactive:()=>Mn,useReactiveX:()=>jo,useService:()=>Gu,useWatch:()=>$u,useWatchEffect:()=>Wu,watch:()=>pu,watchEffect:()=>yu});var $n="4.4.0",Vs=X.TT,Ct={ON_DATA_CHANGED:"ON_DATA_CHANGED",ON_SHARE_CREATED:"ON_SHARE_CREATED",ON_ERROR_OCCURED:"ON_ERROR_OCCURED"},Ot={NO:"no",PRIVATE:"private",GLOBAL:"global"},Wn=0,Xn=Symbol,Ys=typeof Xn=="function";function te(e){return Ys?Xn(e):(Wn+=1,`__HELUX_SYMBOL_${Wn}__`)}var Gs="__proto__",js=we(),Q=!1,Hs=te("HeluxUndefined"),zn=te("HeluxMutateFnItem"),ze=te("HeluxFnKey"),Je=te("HeluxSharedKey"),Jn=te("HeluxReactiveMeta"),xt=te("HeluxIsBlock"),_e=te("HeluxIsAtom"),Ce=te("HeluxIsDerivedAtom"),Ze=[Je,_e,Ce,xt],Qe="SingleMutate",$s="HeluxGlobalLoading",Ws=6,Xs=!0,Zn=2e3,zs=20,Oe="1",Lt="2",qe=1,et=2,Qn=3,Re="|",tt={TASK:"task",MAY_TRANSFER:"may_transfer"},ne={STATIC:"static",HOOK:"hook"},q={USER_STATE:"user_state",GLOGAL_EMPTY:"global_empty",GLOGAL_LOADING:"global_loading",PRIVATE_LOADING:"private_loading"},qn="derive",er="watch",nt="Object",Js="Map",Zs="Array",Qs="Other",H={SET_STATE:"SetState",MUTATE:"Mutate",ACTION:"Action",REACTIVE:"Reactive",LOADING:"Loading",SYNC:"Sync"};function Te(e){var t;return e&&(t=e[_e])!=null?t:!1}function qs(e){return e?e[_e]!==void 0:!1}function le(e){return e&&e[Ce]||!1}function ec(e){return e?e[Ce]!==void 0:!1}function tr(e){return Te(e)||le(e)?e.val:e}function tc(){return{keySeed:{static:0,hook:0,Reactive:0,Mutate:0},runningFnKey:"",runningSharedKey:0,isIgnore:!1,depKeys:[],delPathAoa:[],GID_INSKEYS_MAP:new Map,FNKEY_STATIC_CTX_MAP:new Map,FNKEY_HOOK_CTX_MAP:new Map,DEPKEY_FNKEYS_MAP:new Map,SKEY_FNKEYS_MAP:new Map,UNMOUNT_INFO_MAP:new Map,DEPKEY_COMPUTING_FNKEYS_MAP:new Map}}function nc(){return{keySeed:0,keyPrefix:0,initCount:0,mountedCount:0,latest:{val:null,stateOrResult:null,sharedKey:0,depKey:"",keyPath:[],isDerivedResult:!1,isDerivedAtom:!1},runningKey:"",isDynamic:!1,KEY_CTX_MAP:new Map,KEY_DYNAMIC_CTX_MAP:new Map}}function rc(){return{keySeed:0,UNMOUNT_INFO_MAP:new Map}}function oc(){return{keySeed:0,SHARED_KEY_STATE_MAP:new Map,STATE_SHARED_KEY_MAP:new Map,INTERMAL_MAP:new Map,COMPARE_MAP:new Map,isStateChanged:!1}}function nr(){const e={};return{on:(t,n)=>{Fe(e,t,[]).push(n)},emit:(t,...n)=>{(e[t]||[]).slice().forEach(o=>o(...n))},off:(t,n)=>{const r=e[t]||[],o=r.findIndex(s=>s===n);o>=0&&r.splice(o,1)},canEmit:t=>e[t]}}function rr(){const e={VER:$n,LIMU_VER:X.TT,rootState:{},setState:(t,n)=>{const r=e.ctx.mod[t];if(!r)throw new Error(`moduleName ${t} not found`);r.setState(n)},ctx:{bus:nr(),userBus:nr(),mod:{},middlewares:[],plugins:[],sharedScope:oc(),fnScope:tc(),insScope:rc(),blockScope:nc(),markAtomMap:new Map,renderSN:0,globalLoading:null,globalLoadingInternal:null,globalEmpty:null,globalEmptyInternal:null,isRootRender:!0},legacyRoot:{}};return e}var rt={},or=!1,sr=null,cr=!1;function G(){return rt.ctx||{}}function sc(){return rt}function ar(e){rt=e.ROOT,sr=e.api,or=e.inited}function cc(){return{ROOT:rt,inited:or,API:sr}}function ac(e){if(cr)return!1;cr=!0;const{isRootRender:t=!0}=e;return G().isRootRender=t,!0}function uc(e){const{middlewares:t}=G();t.push(e)}function ic(e,t,n,r){const{middlewares:o}=G();if(!o.length)return;const s={},{sharedKey:c,moduleName:a,forAtom:u}=e,i={forAtom:u,draftRoot:t,draft:n,sharedKey:c,moduleName:a,setData:(l,d)=>s[l]=d,data:s,idx:0,sn:r};o.forEach((l,d)=>{l(j(M({},i),{idx:d}))})}var{ON_DATA_CHANGED:Pt,ON_SHARE_CREATED:ur,ON_ERROR_OCCURED:fc}=Ct,lc=[q.GLOGAL_LOADING,q.PRIVATE_LOADING];function dc(e){const{plugins:t,bus:n}=G();t.push(e);const r={on:(o,s)=>n.on(o,s),onStateChanged:o=>n.on(Pt,o)};e.install(r)}function pc(e,t){const{bus:n}=G();if(n.canEmit(Pt)){const{from:r,desc:o}=t,{forAtom:s,sharedKey:c,moduleName:a,snap:u,usefulName:f,stateType:i}=e;let l;lc.includes(i)?l=`${f}/setState`:l=`${f}@${r||"Api"}/${o}`,n.emit(Pt,{forAtom:s,snap:u,sharedKey:c,moduleName:a,usefulName:f,type:l})}}function yc(e){const{bus:t}=G();if(t.canEmit(ur)){const{forAtom:n,snap:r,sharedKey:o,moduleName:s,usefulName:c}=e,a=`${c}@FactoryApi/createShared`;t.emit(ur,{forAtom:n,snap:r,sharedKey:o,moduleName:s,usefulName:c,type:a})}}function ir(e,t,n){const{bus:r}=G();if(!r.canEmit(t))return!1;const{sharedKey:o,moduleName:s}=e;return r.emit(t,{moduleName:s,sharedKey:o,data:n}),!0}function fr(e,t){ir(e,fc,{err:t})||(console.warn("found uncaught error, sugguest add a plugin to handle this error"),console.error(t))}function hc(){const{userBus:e}=G();return e}function gc(e,...t){const{userBus:n}=G();n.emit(e,...t)}function mc(e,t){const{userBus:n}=G();return n.on(e,t),()=>n.off(e,t)}function Ec(e,t){return e.__proto__=t,e}function vc(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(e,n)||(e[n]=t[n]);return e}var Nt=Object.setPrototypeOf||({__proto__:[]}instanceof Array?Ec:vc);function Sc(e){const t=Object.create(null);return Nt(t,M({},Object.prototype)),e&&Object.assign(t,e),t}function lr(e){if(x(e))return;const t=Object.create(null);return Nt(t,Object.prototype),Nt(e,t),e}function dr(e,t,n){return e[t]=n,!0}function pr(e,t){return e[t]}function xe(e,t){const{set:n=dr,get:r=pr,obj:o={}}=t||{};return Object.keys(e).forEach(s=>{Object.defineProperty(o,s,{enumerable:!0,configurable:!1,set:function(c){return n(e,s,c)},get:function(){return r(e,s)}})}),o}function de(e,t){const{set:n=dr,get:r=pr}=t||{};if(we())return new Proxy(e,{set(c,a,u){return n(c,a,u)},get(c,a){return r(c,a)}});const o=Sc();return xe(o,{obj:o,set:n,get:r})}var Le=G();function ot(e){const n=G()[e];return Le[e]=n,n}function ee(){return Le.blockScope||ot("blockScope")}function V(){return Le.fnScope||ot("fnScope")}function re(){return Le.sharedScope||ot("sharedScope")}function yr(){return Le.insScope||ot("insScope")}function hr(){const{INTERMAL_MAP:e}=re();return e}function Ac(e,t){if(!e||!ue()||!t)return;const{INTERMAL_MAP:n,SHARED_KEY_STATE_MAP:r,STATE_SHARED_KEY_MAP:o}=re();let s=[],c=!1;if(n.forEach(a=>{a.moduleName===e&&a.loc===t&&a.stateType===q.USER_STATE&&s.push(a.sharedKey)}),s.length>1){const a=s[0],u=n.get(a);n.delete(a),u&&(r.delete(u.sharedKey),o.delete(u.rawState))}return c}function Pe(e){return hr().get(e)}function Y(e){const t=oe(e);return Pe(t)}function Kc(e,t){const n=hr(),r=oe(e);n.set(r,t)}function Dc(e){return Y(e).rawState}function gr(e,t=!0){const n=Y(e);return t?n.prevSnap:n.snap}function oe(e){return e&&(e[Je]||re().STATE_SHARED_KEY_MAP.get(e))||0}function Ut(e){let t={state:{},stateRoot:{},isAtom:!1};if(!e)return t;const n=Y(e);if(n){const{sharedState:r,sharedRoot:o}=n;t={state:r,stateRoot:o,isAtom:n.forAtom}}return t}function _c(e){const t=re(),{STATE_SHARED_KEY_MAP:n}=t,r=Me(t.keySeed);return n.set(e,r),t.keySeed=r,r}function Rc(e,t){const{SHARED_KEY_STATE_MAP:n,STATE_SHARED_KEY_MAP:r}=re();n.set(e,t),r.set(t,e)}function Tc(e){return re().SHARED_KEY_STATE_MAP.get(e)}function bc(e,t){if(Q)return;const{rootState:n,ctx:r}=sc(),{moduleName:o,usefulName:s}=t,c=n[s],a=Y(c);if(o&&a&&a.loc!==t.loc){if(!o.endsWith("@Loading")){const u=`
loc1:${a.loc} 
loc2:${t.loc}`;De(`only-dev-mode tip: moduleName ${o} duplicate! this does not effect helux but the duplicated module will be ignored by devtool`+u)}return}n[s]=e,r.mod[s]=Y(e)}var Ic={innerSetState:F};function mr(e,t){const{rawState:n,forAtom:r}=e,o=new Map,s={},c={},a=[],u=M({},n);let f=u;return r&&(f=n.val),j(M(M({ver:0,sn:0,reactive:n,reactiveRoot:n,sync:F,syncer:F,snap:u,prevSnap:u,rawStateVal:f},e),t),{insCtxMap:o,key2InsKeys:s,id2InsKeys:c,recordId(i,l){if(!i)return;const d=Fe(c,i,[]);b(d,l)},delId(i,l){i&&z(c[i]||[],l)},recordDep(i,l){const d=Fe(s,i,[]);b(d,l)},delDep(i,l){z(s[i]||[],l)},mapInsCtx(i,l){o.set(l,i)},delInsCtx(i){o.delete(i)},extra:{},loadingInternal:Ic,level1ArrKeys:a})}var wc={Mutate:"",Reactive:"r",[ne.STATIC]:"s",[ne.HOOK]:"h"};function Mc(){const e=yr(),t=Me(e.keySeed);return e.keySeed=t,t}function Fc(){const e=ee(),{keySeed:t,keyPrefix:n}=e,r=Me(t);e.keySeed=r;let o=n;return Pn(t)&&(o=Me(n),e.keyPrefix=o),`${o}_${r}`}function kc(){const e=G(),t=e.renderSN,n=t===Number.MAX_VALUE?1:t+1;return e.renderSN=n,n}function Bt(e){const t=wc[e],r=V().keySeed,o=Me(r[e]);return r[e]=o,`${t}${o}`}function Cc(){return Bt("Reactive")}var{MAY_TRANSFER:Oc}=tt,{SET_STATE:xc,REACTIVE:Lc}=H,Pc=()=>({isReplaced:!1,replacedValue:null}),Nc=()=>{},Uc=Yt({isFake:!0});function Er(e,t,n=F){const{desc:r="",onRead:o,from:s=Lc,depKeys:c=[],isTop:a=!1,expired:u=!1,insKey:f=0}=t;return{draft:e,finish:n,modified:!1,expired:u,sharedKey:0,moduleName:"",hasFlushTask:!1,nextTickFlush:F,data:[],isTop:a,key:"",fnKey:"",depKeys:c,writeKeys:[],desc:r,onRead:o,from:s,insKey:f}}function Vt(e){const{ids:t=[],globalIds:n=[],isReactive:r=!1,from:o=xc,enableDep:s=!1,handleCbReturn:c=!0,sn:a=kc(),isFirstCall:u=!1,desc:f=""}=e;return{fnKey:"",depKeys:[],forcedDepKeys:[],triggerReasons:[],ids:t,globalIds:n,readKeys:{},writeKeys:{},arrKeyDict:{},writeKeyPathInfo:{},handleCbReturn:c,draftVal:null,from:o,isReactive:r,enableDep:s,sn:a,isFirstCall:u,desc:f}}function Ne(e,t,n){const{isChanged:r=!0,parentKeyPath:o=[],op:s="set",parentType:c="Object"}=n,a=o.slice();return a.push(e),{isChanged:r,isCustom:!1,op:s,immutBase:!1,key:e,value:t,proxyValue:t,parentType:c,keyPath:o,fullKeyPath:a,isBuiltInFnKey:!1,replaceValue:F,getReplaced:Pc}}function Yt(e){const l=e||{},{desc:t="",fn:n=F,task:r=Nc,depKeys:o=[],writeKeys:s=[],deps:c=Ke,isFake:a=!1,onlyDeps:u=!1}=l,f=As(l,["desc","fn","task","depKeys","writeKeys","deps","isFake","onlyDeps"]);return M({fn:n,task:r,deps:c,oriDesc:"",onlyDeps:u,desc:t,depKeys:o,writeKeys:s,checkDeadCycle:void 0,watchKey:"",isFake:a,enabled:!0,extraBound:{state:{},stateRoot:{},isAtom:!1}},f)}function vr(){const e={fnKey:"",fn:F,subFnInfo:Uc,checkDeadCycle:!0,isFirstLevel:!0,isExpired:!1,task:F,deps:Ke,status:{loading:!1,err:null,ok:!0},stateRoot:{},isStateAtom:!1,forAtom:!1,remainRunCount:0,showLoading:!1,nextLevelFnKeys:[],prevLevelFnKeys:[],mountStatus:qe,depKeys:[],depSharedKeys:[],result:{},fnType:"watch",returnUpstreamResult:!1,scopeType:"static",renderStatus:Oe,proxyResult:{},updater:F,createTime:Date.now(),shouldReplaceResult:!1,isAsync:!1,isAsyncTransfer:!1,isSimpleWatch:!1,isRunning:!1,dcErrorInfo:{err:null,tipFn:F},asyncType:Oc,subscribe:t=>{t()},extra:{},setLoading:(t,n=null)=>{const r=!t&&!n;e.status={loading:t,err:n,ok:r}},renderInfo:{time:0,insKey:0,sn:0,getDeps:()=>e.depKeys.slice()}};return e}var Sr={draftRoot:{val:null},isFake:!0,isAtom:!0},Ar=Vt({}),st=Er(!0,{expired:!0}),il=Yt(),Kr=mr({rawState:{},forAtom:!1,usefulName:""},{}),Dr=vr(),ct=Sr,Gt=Ar,_r="",jt=new Map,Ht=new Map,$t=new Map,Wt=F,Xt=[],zt="";function Bc(){return ct}var Ue={current:()=>zt,set:e=>zt=e,del:()=>zt=""},Jt={current:()=>Wt,set:e=>Wt=e,del:()=>Wt=F},Be={current:e=>Ht.get(e)||"SetState",set:(e,t)=>Ht.set(e,t),del:e=>Ht.delete(e)},Ve={current:()=>Xt,set:e=>Xt=e,del:()=>Xt=[]},se={current:()=>$t.get(_r)||st,markUsing:e=>_r=e,set:(e,t)=>$t.set(e,t),del:e=>$t.delete(e)},Zt={current:e=>jt.get(e),set:(e,t)=>jt.set(e,t),del:e=>jt.delete(e)},at={current:()=>ct,set:(e,t)=>{Object.assign(ct,{draftRoot:e,isAtom:t,isFake:!1})},del:()=>ct=Sr},Qt={current:()=>Gt,set:e=>Gt=e,del:()=>Gt=Ar};function qt(e){const{FNKEY_STATIC_CTX_MAP:t,FNKEY_HOOK_CTX_MAP:n}=V();return e[0]==="s"?t:n}function Vc(e,t){const{DEPKEY_COMPUTING_FNKEYS_MAP:n}=V();ke(n,e,[]).push(t)}function Yc(e,t){const{DEPKEY_COMPUTING_FNKEYS_MAP:n}=V(),r=n.get(e);r&&z(r,t)}function Gc(e){const{DEPKEY_FNKEYS_MAP:t,SKEY_FNKEYS_MAP:n}=V(),{depKeys:r,fnKey:o,depSharedKeys:s}=e,c=[];r.forEach(a=>{const u=t.get(a)||[];z(u,o),b(c,o)}),s.forEach(a=>{const u=n.get(String(a))||[];c.forEach(f=>{z(u,f)})})}function Rr(e,t){const{FNKEY_STATIC_CTX_MAP:n}=V(),{fnKey:r,prevLevelFnKeys:o}=e;o.forEach(s=>{var a;const c=(a=n.get(s))==null?void 0:a.nextLevelFnKeys;c&&(t?b(c,r):z(c,r))})}function jc(){const{FNKEY_HOOK_CTX_MAP:e}=V();ue()&&e.forEach(t=>{t.isExpired=!0})}function Tr(e,t,n){const r=n||Bt(t);return x(e)?e[ze]=r:(lr(e),e.__proto__[ze]=r),r}function br(e){return x(e)?e[ze]||"":J(e)&&e.__proto__[ze]||""}function pe(e){return qt(e).get(e)}function en(e){return qt(e).get(e)||Dr}function Ye(e){const t=br(e);return pe(t)||null}function Ge(){const{runningFnKey:e,depKeys:t,runningSharedKey:n,isIgnore:r,delPathAoa:o}=V();return{fnCtx:e?pe(e):null,depKeys:t,delPathAoa:o,isIgnore:r,runningSharedKey:n}}function Hc(){return V().runningFnKey}var{USER_STATE:$c}=q;function Wc(e,t=8){let n="";if(ue()&&e)try{throw new Error("loc")}catch(r){const o=r.stack.split(`
`),s=o[1]||"";s.includes("webpack-internal")||s.includes("/node_modules/")?n=o.slice(0,16).join(" -> "):n=o.map(a=>a.substring(0,a.indexOf("(")).trim()).slice(4,t).join(" -> ")}return n}function Ir(e){const[t,n]=e.split("/"),r=n.split(Re);return{sharedKey:Number(t),keyPath:r,depKey:e}}function wr(e){const{sharedKey:t,forAtom:n}=e,r=n?"/val":"",o=n?["val"]:[];return{depKey:`${t}${r}`,keyPath:o,sharedKey:t}}function $(e,t){try{return It(e.join(Re),t)}catch(n){return console.warn("found Symbol key in your path :",e),`${t}`}}function Xc(e,t){const{snap:n,prevSnap:r,stateType:o}=e;if($c!==o)return!0;const{keyPath:s}=Ir(t);try{const c=fe(n,s),a=fe(r,s);return c!==a}catch(c){return!0}}function zc(e,t){return we()?(0,X.OA)(e,{onOperate:t,compareVer:!0}):de(e,{get(n,r){const o=n[r],s=Ne(r,o,{isChanged:!1,parentKeyPath:[]});return t(s),o}})}function Jc(e,t){if(t!==void 0){if(e)return{val:t};if(J(t))return t}}function Zc(e,t,n){const r=x(t)?t(n):t;return Jc(e,r)}function ut(e,t){let{value:n}=e;if(t){t(e);const{replacedValue:r,isReplaced:o}=e.getReplaced();o&&(n=r)}return n}function Mr(e){return[Zs,Js].includes(e)}function Qc(e){return Array.isArray(e)||Rt(e)}var{isObject:ye,getDataType:Fr}=X.limuUtils;function tn(e,t){return typeof e=="boolean"?e:t}function kr(e,t){if(e===t)return e;const r=t.substring(e.length+1).split(Re);return`${e}${Re}${r[0]}`}function qc(e,t){Ae(e,t)||b(e,t)}var nn=new Map;function Cr(e,t){let n=!1;const{depKey:r,keyPath:o,sharedKey:s}=e,{stopDepInfo:c,level1ArrKeys:a,recordCb:u}=t,f=nn.get(r);if(f)return u(f),!0;const{keys:i,isArrDict:l,depth:d,arrKeyStopDcit:p,stopArrDep:y}=c,g=Ae(a,r),h=o.length>d;if(h||g){let E="",_=d;return g&&(_=d+1,p[g]===!1||y&&(h?E=$(o.slice(0,_),s):E=kr(g,r))),E||(E=$(o.slice(0,_),s)),g||nn.set(r,E),u(E),!0}const m=String(s);for(const E of i){if(!r.startsWith(E)||E===m)continue;const _=l[E],A=_?kr(E,r):E;_||nn.set(r,A),u(A),n=!0;break}return n}function rn(e,t){const n=ee(),{runningKey:r}=n;if(r){const{KEY_DYNAMIC_CTX_MAP:o,KEY_CTX_MAP:s,isDynamic:c}=n,u=(c?o:s).get(r);if(u){const{results:f,depKeys:i}=u;t?b(f,t):e.forEach(l=>b(i,l))}}}function it(e,t){const n=re(),{COMPARE_MAP:r}=n;let o=r.get(t);return o!==void 0?o:e.sharedKeyStr===t?n.isStateChanged:(o=Xc(e,t),r.set(t,o),o&&(n.isStateChanged=!0),o)}function Or(e,t,n){if(t.includes(n)&&it(e,n))return!0;let r=!1;for(const o of t)o.startsWith(n)&&it(e,o)&&(r=!0);return r}function ea(){const e=re();e.COMPARE_MAP.clear(),e.isStateChanged=!1}function on(e=!0){const t=V();t.isIgnore=e}function be(e,t){const{fnCtx:n,depKeys:r,isIgnore:o}=Ge(),s=t.specificCtx||n;if(!s){Jt.current()(e);return}const{fnKey:c,scopeType:a}=s;if(Q&&a==="hook")return;const{DEPKEY_FNKEYS_MAP:u,SKEY_FNKEYS_MAP:f}=V(),{belongCtx:i,sharedKey:l}=t;if(l&&b(s.depSharedKeys,l),n&&i){n.isFirstLevel=!1,i.isAsync&&(n.isAsync=!0);const d=i.fnKey;b(s.prevLevelFnKeys,d),b(i.nextLevelFnKeys,n.fnKey)}e.forEach(d=>{if(Gs===d||o)return;n&&b(r,d);const p=ke(u,d,[]);b(p,c);const[y]=d.split("/"),g=ke(f,y,[]);b(g,c)})}function sn(e){e&&e.depKeys.forEach(t=>be([t],{specificCtx:e}))}function xr(e){const{FNKEY_HOOK_CTX_MAP:t,UNMOUNT_INFO_MAP:n}=V();if(Q)return;const{fnKey:r}=e;t.set(r,e),Rr(e,!0);let o=n.get(r);o?o.c=2:(o={c:1,t:Date.now(),prev:0},n.set(r,o));const{c:s}=o;if(s===2){const c=pe(r);sn(c)}}function Lr(e){let t="";return e.depSharedKeys.forEach(n=>{var o;const r=((o=Pe(n))==null?void 0:o.ver)||0;t+=`${r}_`}),t}function ta(e,t,n,r=!1){const{DEPKEY_FNKEYS_MAP:o,SKEY_FNKEYS_MAP:s}=V(),a=(r?s:o).get(t)||[],u=[],f=[];return a.forEach(i=>{const l=pe(i);if(l&&Or(e,l.depKeys,t)){l.isFirstLevel&&u.push(i),l.isAsync&&l.fnType===qn&&f.push(i);const d=n[i];d===void 0?n[i]=1:r||(n[i]=d+1)}}),{firstLevelFnKeys:u,asyncFnKeys:f}}function ft(e){Gc(e),Rr(e)}function na(){const{FNKEY_HOOK_CTX_MAP:e}=V();if(e.size>=zs){const t=Date.now();e.forEach(n=>{const{mountStatus:r,createTime:o,fnKey:s}=n;[qe,Qn].includes(r)&&t-o>Zn&&(ft(n),e.delete(s))})}}function cn(e,t,n,r,o,s=!1,c=!1){const a=ee();a.latest={sharedKey:e,val:t,stateOrResult:n,depKey:r,keyPath:o,isDerivedResult:s,isDerivedAtom:c}}function ra(){return ee().latest}function Pr(e){const{KEY_DYNAMIC_CTX_MAP:t,KEY_CTX_MAP:n}=ee();return e?t:n}function Nr(){return De("changing shared state is invalid"),!0}function lt(e,t,n,r,o){return r===_e?e?t:!1:r===Je?n:o}function an(e,t,n){e.replaceValue(lt(e.keyPath.length===0,t,n,e.key,e.value))}function oa(e){let t={};const{rawState:n,sharedKey:r,forAtom:o,onRead:s,isPrimitive:c,stopDepth:a}=e,u=(i,l)=>{const d=$(i,r);be([d],{sharedKey:r}),rn([d]),cn(r,l,t,d,i)};if(js)t=(0,X.OA)(n,{customKeys:Ze,onOperate:i=>{const{isBuiltInFnKey:l,isCustom:d}=i;if(d)return an(i,o,r);if(!l){const{fullKeyPath:p}=i,y=ut(i,s);u(p,y)}},compareVer:!0});else{const i=(l,d,p)=>xe(l,{set:Nr,get:(y,g)=>{const h=y[g];if(Ze.includes(g))return lt(d===1,o,r,g,h);const m=Ne(g,h,{isChanged:!1,parentKeyPath:p});if(d<a&&ye(h))return i(h,d+1,m.fullKeyPath);const E=ut(m,s);return u(m.fullKeyPath,E),E}});t=i(n,1,[])}let f=t;return o&&(c?f=n.val:f=de(n,{set:Nr,get:(i,l)=>t.val[l]})),Rc(r,t),{sharedRoot:t,sharedState:f}}var Ur=null;function un(){return Ur}function sa(e,t){const n=G();let r=n.globalEmpty;if(!r){const{stateRoot:o}=t({apiCtx:e,rawState:{},forGlobal:!0,stateType:q.GLOGAL_EMPTY}),s=Y(o);n.globalEmpty=o,n.globalEmptyInternal=s}return Ur=r,r}function fn(e){const{GID_INSKEYS_MAP:t}=V();return ke(t,e,[])}function ca(){return G().globalEmptyInternal}function Br(e,t){if(!e||Q)return;const n=fn(e);b(n,t)}function aa(e,t){if(!e)return;const n=fn(e);z(n,t)}var{REACTIVE:ua}=H,je=new Map;function ia(e){return!!(e&&!e.expired&&e.modified)}function fa(e){const{sharedKey:t}=e;e.expired=!0,se.del(e.key);const n=Be.current(t);return Be.del(t),e.finish(null,{desc:n})}function Vr(e,t){const n=oe(e);return t&&Be.set(n,t),n}function ln(e,t){const n=oe(e);He(n,t)}function la(){const e=se.current();e.isTop&&He(e.sharedKey,e.desc)}function He(e,t){const n=je.get(e);ia(n)&&(t&&Be.set(e,t),fa(n))}function da(e){const t=je.get(e)||st;t.expired=!0}function pa(e,t){const n=je.get(e)||st;n.modified=!0,n.nextTickFlush(t)}function ya(e,t){const{from:n=ua}=t,{finish:r,draftRoot:o}=e.setStateFactory({isReactive:!0,from:n,handleCbReturn:!1,enableDep:!0}),s=Er(o,t,r);return s.key=Cc(),s.sharedKey=e.sharedKey,s.nextTickFlush=c=>{const{expired:a,hasFlushTask:u}=s;a||(s.data=[c]),u||(s.hasFlushTask=!0,Promise.resolve().then(()=>{const[f]=s.data;He(e.sharedKey,f)}))},s}function Yr(e,t,n){const{sharedKey:r}=e,{insKey:o=0,from:s}=t;let c=je.get(r)||st;c.expired&&(c=ya(e,{isTop:!0,from:s}),je.set(r,c),se.set(c.key,c),c.fnKey=Ue.current()),se.markUsing(c.key),c.onRead=o?t.onRead:void 0,c.insKey=o;const{draft:a}=c;return{val:n?a.val:a,meta:c}}function dn(e,t){let n={},r={};const{rawState:o,deep:s,forAtom:c,isPrimitive:a,sharedKey:u}=e;if(wt(s)){const f={[Je]:u,[_e]:c},i=(d,p,y)=>{const{val:g}=Yr(e,t,d);return g[p]=y,!0},l=(d,p,y)=>{const g=y[p];if(g!==void 0)return g;const{val:h,meta:m}=Yr(e,t,d);return Jn===p?m:h[p]};if(n=new Proxy(o,{set:(d,p,y)=>i(!1,p,y),get:(d,p)=>l(!1,p,f)}),r=n,c){const d=j(M({},f),{[_e]:!1});r=a?o.val:new Proxy(o.val,{set:(p,y,g)=>i(!0,y,g),get:(p,y)=>l(!0,y,d)})}}else n=o,r=o.val;return{draftRoot:n,draft:r}}function ha(e){const{UNMOUNT_INFO_MAP:t}=yr(),{insKey:n,readMap:r,internal:o}=e;o.mapInsCtx(e,n);let s=t.get(n);s?(s.c=2,s.prev=n-1):(s={c:1,t:Date.now(),prev:0},t.set(n,s));const{c}=s;c===2&&Object.keys(r).forEach(a=>{o.recordDep(a,n)})}function Gr(e){const{readMap:t,insKey:n,internal:r}=e;Object.keys(t).forEach(o=>r.delDep(o,n)),r.delInsCtx(n)}function ga(e){const{canCollect:t,isFirstRender:n,currentDepKeys:r}=e;if(!t){n&&(e.depKeys=r.slice());return}e.depKeys=r.slice()}function ma(e){const{canCollect:t}=e;t&&(e.readMap={},e.delReadMap={},e.depKeys=e.currentDepKeys.slice(),e.currentDepKeys.length=0)}function jr(e,t,n){if(!e.canCollect)return;const{parentType:r,rawVal:o}=n,s=Qc(o);s&&qc(e.internal.level1ArrKeys,t.depKey),e.recordDep(t,r,s)}function pn(e,t){const{depKeys:n,currentDepKeys:r,fixedDepKeys:o}=e;return(t?r:n).concat(o)}function Ea(e){if(!e)return;const{updater:t,mountStatus:n,createTime:r}=e;if(n===qe){Date.now()-r>Zn?Gr(e):e.needEFUpdate=!0;return}t()}function Hr(e){const{internal:t,isReactive:n,insKey:r}=e,{rawState:o,isDeep:s,sharedKey:c,onRead:a,forAtom:u}=t;if(s){const f=i=>{if(Q)return;const{isBuiltInFnKey:l,key:d}=i;if(l)return;if(Tt(d))return an(i,u,c);const{fullKeyPath:p,keyPath:y,parentType:g}=i,h=ut(i,a),E={depKey:$(p,c),keyPath:p,parentKeyPath:y,sharedKey:c};jr(e,E,{parentType:g,rawVal:h})};if(n){const{draft:i,draftRoot:l}=dn(t,{onRead:f,insKey:r});e.proxyState=l,e.proxyStateVal=i}else e.proxyState=(0,X.OA)(o,{onOperate:f,compareVer:!0})}else e.proxyState=de(o,{set:()=>(De("changing shared state is invalid"),!0),get:(f,i)=>{if(Q)return;const l=f[i];if(Tt(i))return lt(!0,u,c,i,l);const d=ut(Ne(i,l,{isChanged:!1,parentKeyPath:[]}),a),p=It(i,c),y=ye(f)?nt:Qs;return jr(e,{depKey:p,keyPath:[i],sharedKey:c},{parentType:y,rawVal:d}),d}})}function va(e){var k;const{updater:t,sharedState:n,id:r="",globalId:o="",collectType:s="every",deps:c,pure:a=!0,arrDep:u=!0,isReactive:f=!1}=e,i=u&&(k=e.arrIndexDep)!=null?k:!0,l=Y(n);if(!l)throw new Error("ERR_OBJ_NOT_SHARED: input object is not a result returned by share api");const d=Mc(),{rawState:p,isDeep:y,ver:g,ruleConf:h,level1ArrKeys:m,forAtom:E,sharedKey:_,sharedKeyStr:A,snap:w}=l,{stopDepInfo:I}=h,D={readMap:{},delReadMap:{},pure:a,depKeys:[],fixedDepKeys:[],currentDepKeys:[],isDeep:y,isReactive:f,insKey:d,internal:l,rawState:p,sharedState:n,sharedKey:_,proxyState:{},proxyStateVal:{},updater:t,mountStatus:qe,renderStatus:Oe,needEFUpdate:!1,createTime:Date.now(),rootVal:null,ver:g,id:r,globalId:o,collectType:s,canCollect:s!=="no",isFirstRender:!0,subscribe:v=>{v()},extra:{},getDeps:()=>pn(D,!0),renderInfo:{isAtom:E,setDraft:l.insSetDraft,time:Date.now(),sn:0,snap:w,insKey:d,getDeps:()=>pn(D,!0),getPrevDeps:()=>pn(D,!1)},recordDep:(v,S,K)=>{let T=v.depKey;Cr(v,{stopDepInfo:I,level1ArrKeys:m,recordCb:ve=>{T=ve}});const{renderStatus:L,fixedDepKeys:R}=D;if(L===Lt)return;const{readMap:C,insKey:At,currentDepKeys:N,delReadMap:O}=D;be([T],{}),Hc()&&(z(N,T),b(D.fixedDepKeys,T));const ae=()=>{C[T]=1,l.recordDep(T,At),R.includes(T)||b(N,T)};if(!C[T]&&!O[T]){const{parentKeyPath:ve}=v;if(a&&S===nt&&ve){const Dt=ve.length?$(ve,_):A;C[Dt]&&(delete C[Dt],O[Dt]=1,z(N,Dt))}const Kt=Mr(S);if(Kt){i&&ae();return}(!K||!Kt&&u)&&ae()}}};if(o&&Br(o,d),Hr(D),Q)return D;if(l.mapInsCtx(D,d),l.recordId(r,d),x(c)){const v=E?D.proxyState.val:D.proxyState,S=W(c,v),K=D.getDeps().slice();S.includes(v)&&K.push(l.rootValKey),D.fixedDepKeys=K}return D}function $r(e){const{result:t,forAtom:n}=e;e.proxyResult=de(t,{set:()=>(De("changing derived result is invalid"),!1),get:(r,o)=>Ce===o?n:(Oe===e.renderStatus&&!Q&&sn(e),t[o])})}function Sa(e){const{proxyState:t,internal:n,renderInfo:r,canCollect:o,isReactive:s}=e,{sharedKey:c,sharedKeyStr:a,insSetState:u,forAtom:f}=n;r.snap=n.snap,r.time=Date.now();const i=f?t.val:t;return e.isFirstRender&&(e.rootVal=i,Zt.set(e.rootVal,e)),!f&&o&&e.recordDep({depKey:a,keyPath:[],sharedKey:c},nt),[s?t:i,u,r]}function Aa(e,t){if(t&&!Te(e))throw new Error("useAtom only accept atom")}function Ka(e){const{ver:t,internal:{ver:n}}=e;t!==n&&(e.ver=n,Hr(e))}function Da(e){e.mountStatus=et;const{id:t,globalId:n,insKey:r}=e;e.internal.recordId(t,r),Br(n,r),ha(e)}function _a(e){e.mountStatus=Qn;const{id:t,globalId:n,insKey:r}=e;e.internal.delId(t,r),aa(n,r),Gr(e)}function Ra(e,t){const n=Y(t).sharedKey;return e.internal.sharedKey!==n}function dt(e,t,n,r){if(G().isRootRender)try{const o=r||n;e.react.useSyncExternalStore(t,n,o)}catch(o){console.error(o)}}var Ta=null;function Wr(e,t,n){const{hookImpl:r,react:o}=e,s=r.useForceUpdate(),c=o.useRef({ctx:Ta});let a=c.current.ctx;return(!a||Ra(a,t))&&(a=va(M({updater:s,sharedState:t},n)),c.current.ctx=a),a}function Xr(e,t){e.react.useEffect(()=>(t.isFirstRender=!1,Zt.del(t.rootVal),t.collectType==="first"&&(t.canCollect=!1),t.needEFUpdate&&(t.needEFUpdate=!1,t.updater()),Da(t),()=>{_a(t)}),[t])}function ba(e,t,n,r){n.renderStatus=Oe,ma(n),dt(e,n.subscribe,()=>Y(t).snap),e.react.useEffect(()=>{n.renderStatus=Lt,n.isFirstRender=!1,ga(n)})}function yn(e,t,n={}){const r=Wr(e,t,n);return dt(e,r.subscribe,()=>Y(t).snap),Xr(e,r),r}function pt(e,t,n={}){const{forAtom:r}=n;Aa(t,r);const o=Wr(e,t,n);return ba(e,t,o,n),Xr(e,o),Ka(o),{tuple:Sa(o),insCtx:o}}function zr(e,t){const{forAtom:n,label:r,strict:o=!1}=t||{};let s;if(typeof e=="number"?s=Pe(e):s=Y(e),!s&&e){const a=e[Jn];s=Pe(a==null?void 0:a.sharedKey)}let c=r?`[[${r}]] err:`:"err:";if(!s)if(o)ie(`${c} not a valid shared or atom`,{throwErr:!0});else return null;return n!==void 0&&(n&&!s.forAtom&&ie(`${c} expect a shared but recived a atom`,{throwErr:!0}),!n&&s.forAtom&&ie(`${c} expect a atom but recived a shared`,{throwErr:!0})),s}function he(e,t){return zr(e,j(M({},t||{}),{strict:!0}))}var{MUTATE:Ia,LOADING:wa}=H,{GLOGAL_LOADING:Ma,PRIVATE_LOADING:Fa}=q,{PRIVATE:ka,GLOBAL:Ca}=Ot,Jr={},Oa={},xa={time:0,sn:0,getDeps:Ke,getPrevDeps:Ke,insKey:0,setDraft:F,isAtom:!1},La=[ge(Jr,Oa,Ia),F,xa];function Pa(e,t){const{internal:n,apiCtx:r}=t,{mutateFnDict:o,moduleName:s}=n,c={};Object.keys(o).forEach(f=>{c[f]={loading:!1,err:null,ok:!0}});const a=s?`${s}@Loading`:"";return e({apiCtx:r,rawState:c,isLoading:!0,stateType:Fa},{moduleName:a}).state}var Zr=null;function Na(){return Zr}function Qr(){return G().globalLoadingInternal}function Ua(e,t){const n=G();let r=n.globalLoading;if(!r){const{stateRoot:o}=t({apiCtx:e,rawState:{},stateType:Ma},{moduleName:$s}),s=Y(o);n.globalLoadingInternal=s,n.globalLoading=o}return Zr=r,r}function hn(e,t){let n=t;return Tt(t)&&(n=t.toString()),`${e}>${n}`}function qr(e,t,n){if(!t)return;const{loadingInternal:r}=e;r.innerSetState(o=>{o[t]=n},{from:wa}),n.err&&(ir(e,Ct.ON_ERROR_OCCURED,{err:n.err}),console.error(n.err))}function ge(e,t,n){let r=e[n];return r||(r=de(t,{get(o,s){const c=hn(n,s);return o[c]||{loading:!1,ok:!0,err:null}}}),e[n]=r),r}function $e(e,t){const{internal:n,from:r}=t,{stateType:o,recordLoading:s}=n,c=q.USER_STATE===o;let a=ge(Jr,{},r),u={};if(c)if(ka===s)u=n.extra.loadingProxy,u||(u=Pa(e,t),n.extra.loadingProxy=u,n.loadingInternal=Y(u)),a=ge(n.extra,u,r);else if(Ca===s){const f=Qr();u=Na(),n.loadingInternal=f,a=ge(f.extra,u,r)}else u=un();else u=n.sharedState,a=ge(n.extra,u,r);return{loadingState:a,loadingProxy:u}}function eo(e,t){if(!ye(t))return e;const n=Object.keys(t);if(!n.length)return e;const r=t[n[0]];return r.__sharedKey?j(M({},e),{internal:he(r.__sharedKey)}):e}function to(e,t){const{internal:n,from:r,apiCtx:o}=t,{stateType:s}=n,c=q.USER_STATE===s;$e(e,t);let a=()=>La;return c&&(a=u=>{const f=eo(t,u),i=$e(e,f).loadingProxy,{insCtx:{proxyState:l,internal:d,extra:p,renderInfo:y}}=pt(o,i);return[ge(p,l,r),d.setState,y]}),{useLoading:a,getLoading:u=>{const f=eo(t,u);return $e(e,f).loadingState}}}function yt(e){const t=vr();return Object.assign(t,e||{})}function me(){const e=V(),{runningFnKey:t}=e;if(!t)return[];const n=pe(t);let r=[];if(n){const{depKeys:o,delPathAoa:s,runningSharedKey:c}=e,{depKeys:a}=n,u={};o.forEach(i=>u[i]=1),o.forEach(i=>{const l=Un(u,i);l&&l!==i&&delete u[l]}),Object.keys(u).forEach(i=>b(a,i)),s.forEach(i=>{const l=i.length;for(let d=1;d<=l;d++){const p=$(i.slice(0,d),c);z(a,p)}}),r=a.slice()}return e.runningFnKey="",e.depKeys=[],e.delPathAoa=[],e.runningSharedKey=0,r}function gn(e,t){const n=V();n.runningFnKey=e,n.runningSharedKey=t,n.isIgnore=!1}function no(e,t){const{specificProps:n,fnCtxBase:r}=t,{scopeType:o}=n,s=Tr(e,o),c=M({fn:e,fnKey:s},n),a=r?Object.assign(r,c):yt(c);return(o==="static"||!Q)&&qt(o).set(s,a),a}function mn(e){var o;const{FNKEY_HOOK_CTX_MAP:t,UNMOUNT_INFO_MAP:n}=V(),{fnKey:r}=e;ft(e),e.extra.deferedWatch=null,t.delete(r),((o=n.get(r))==null?void 0:o.c)===2&&n.delete(r),na()}function ro(e){const{DEPKEY_COMPUTING_FNKEYS_MAP:t}=V(),{prevLevelFnKeys:n,depKeys:r}=e;let o=!1;for(const s of r){const c=t.get(s)||[];if(We(c,n)){o=!0;break}}return o}function Ba(e,t=!0,n=Re){return e.map(r=>{const[o,s]=r.split("/"),c=s.split(Re);return`${t?`${Pe(Number(o)).usefulName}/`:""}${c.join(n)}`})}var ht=new Map,gt={WATCH:"1",MUTATE:"2"},Va={[gt.WATCH]:"watch",[gt.MUTATE]:"mutate fn or task"};function Ya(e=0){return{sn:e,descs:[],errs:[],timer:null,cycle:[]}}function oo(e,t,n){const r=new Error(`DEAD_CYCLE: module(${e}) found mutate fn(${n}) in these dead cycle fns [${t.join(",")}]`);return r.cause="DeadCycle",r.data=t,r}function Ga(e){ht.delete(e)}function ja(e,t,n,r){const o=Va[r],{desc:s,task:c,fn:a,isFake:u}=t.subFnInfo,f=s?`(${s})`:"",i=`DEAD_CYCLE: found reactive object in ${o}${f} cb is changing module(${e.usefulName})'s some of these dep keys(${Ba(n,!1,".")}), it will cause a infinity loop call!`,l=u?t.fn:c||a;return{err:new Error(`[only-dev-mode alert] ${i}`),tipFn:()=>console.error(` ${i} open the stack to find the below fn: 
`,l)}}function Ha(e,t,n){if(e&&n){const{usefulName:r}=e,o=ke(ht,r,Ya(t));o.sn!==t&&(o.descs=[],o.errs=[]);const{descs:s}=o;if(s.length>1&&s[0]===n){const c=s.slice();throw o.cycle=c,s.length=0,oo(r,c,n)}b(s,n)}}function En(e,t){t.tipFn(),ie(t.err,{logErr:!1,throwErr:!1,alertErr:e.alertDeadCycleErr})}function Ee(e,t,n){const{depKeys:r,subFnInfo:o}=t;let s=t.depKeys,c=n;r.length>n.length&&(s=n,c=r);let a=!1;if(We(s,c)){const u=o.desc?gt.MUTATE:gt.WATCH,f=ja(e,t,n,u);En(e,f),t.dcErrorInfo=f,a=!0}return a}function $a(e,t){const n=ht.get(e);return!n||!n.cycle.includes(t)?{isIn:!1,cycle:[]}:{isIn:!0,cycle:n.cycle}}function Wa(e,t,n=!0){const r=ht.get(e);if(!r)return;const{timer:o,errs:s}=r;s.push(t),o&&clearTimeout(o),r.timer=setTimeout(()=>{let c=null;for(const a of s)c?a.data.length>c.data.length&&(c=a):c=a;c&&ie(c,{alertErr:n}),s.length=0},0)}function vn(e,t=0){const n=pe(e);n&&(n.showLoading&&(n.setLoading(!0),n.updater()),t&&(n.remainRunCount+=t))}var{MAY_TRANSFER:Xa}=tt;function za(e,t){const{isFirstCall:n=!1,triggerReasons:r=[],sn:o=0,from:s,internal:c=Kr,desc:a,fromFnKey:u}=t;if(e.dcErrorInfo.err){En(c,e.dcErrorInfo);return}if(e.fnKey===u){Ee(c,e,e.depKeys);return}if(e.isSimpleWatch||!e.checkDeadCycle)return e.fn({isFirstCall:n,triggerReasons:r,sn:o});if(H.MUTATE===s&&Ha(c,o,a),e.isRunning&&Ee(c,e,t.depKeys||[]))return;const f=se.current();if(f.fnKey===e.fnKey&&Ee(c,e,f.writeKeys)||(He(f.sharedKey,f.desc),e.isRunning===!0&&f.isTop&&Ee(c,e,f.writeKeys)))return;e.isRunning=!0,Ue.set(e.fnKey);const l=e.fn({isFirstCall:n,triggerReasons:r,sn:o});Ue.del();const d=se.current();if(!(d.isTop&&d.fnKey===e.fnKey&&Ee(c,e,d.writeKeys))&&!(l&&l.task&&d.from===H.MUTATE&&Ee(c,e,e.subFnInfo.writeKeys)))return e.isRunning=!1,l}function so(e,t,n){let r=t.val;return n||(r=t),{input:W(e,{state:r,stateRoot:t,isAtom:n}),state:r,stateRoot:t}}function Ie(e,t={}){const{isFirstCall:n=!1,forceFn:r=!1,forceTask:o=!1,throwErr:s=!1,triggerReasons:c=[],watchFnKeys:a=[],skipWatch:u=!1,sn:f=0,err:i,unbox:l=!1,internal:d=Kr}=t,p=pe(e),y=(N=null)=>{if(N&&s)throw N;const O=p||Dr;return l?[O.result.val,N]:[O.result,N]};if(!p)return y(new Error(`not a valid watch or derive cb for key ${e}`));if(p.fnType===er)return u?b(a,p.fnKey):za(p,t);const{isAsync:g,fn:h,task:m,isAsyncTransfer:E,forAtom:_,result:A,depKeys:w}=p;p.remainRunCount>0&&(p.remainRunCount-=1);const I=N=>{const O=_?{val:N}:N;!p.returnUpstreamResult&&O&&Object.assign(p.result,O),p.shouldReplaceResult=!0},D=()=>{p.renderInfo.sn=f,p.updater()},k=N=>{const{data:O,err:ae=null}=N;ae?p.setLoading(!1,ae):(I(O),n?g&&p.status.loading&&!ro(p)&&p.setLoading(!1,ae):p.remainRunCount===0&&p.setLoading(!1,ae)),D();const ve={isFirstCall:n,sn:f,triggerReasons:c,err:ae,watchFnKeys:a,skipWatch:u};p.nextLevelFnKeys.forEach(Kt=>{Ie(Kt,ve)})},v=_?A:A.val,{deps:S,isStateAtom:K}=p,{input:T,state:L,stateRoot:R}=so(S,p.stateRoot,K),C={isAtom:p.isStateAtom,state:L,stateRoot:R,isFirstCall:n,prevResult:v,triggerReasons:c,input:T,sn:f};if(!g||r||g&&!m){const N=h(C);return k({data:N}),y()}if(g&&n&&p.nextLevelFnKeys.forEach(N=>vn(N,0)),E)return k({err:i}),y();if(p.asyncType===Xa){const N=h(C);return k({data:N}),y()}if(m){let N=Ds;return n?(w.forEach(O=>Vc(O,e)),N=()=>w.forEach(O=>Yc(O,e))):o&&p.nextLevelFnKeys.forEach(O=>vn(O)),Promise.resolve(()=>{const O=m(C);return bt(O)?O:(ie("ERR_NON_FN: derive task arg should be async function!",{throwErr:s}),null)}).then(O=>O()).then(O=>(N(),k({data:O}),y())).catch(O=>{if(N(),k({err:O}),s)throw O;return fr(d,O),y(O)})}return y(i)}function mt(e,t){const n=Ye(e);if(!n)throw new Error("[Helux]: not a derived result");return Ie(n.fnKey,M({},t||{}))}function Ja(e,t){return mt(e,{forceFn:!0,throwErr:t})}function Za(e,t){return Promise.resolve(mt(e,{forceTask:!0,throwErr:t}))}function Qa(e,t){return mt(e,{forceFn:!0,throwErr:t,unbox:!0})}function qa(e,t){return Promise.resolve(mt(e,{forceTask:!0,throwErr:t,unbox:!0}))}function eu(e){const t=Ye(e);return t?t.status:{loading:!1,err:null,ok:!0}}function Sn(e,t,n){const r=e.get(t);r&&(r.renderInfo.sn=n,Ea(r))}function tu(e){const{mutateCtx:t,internal:n}=e,{ids:r,globalIds:o,depKeys:s,triggerReasons:c,isFirstCall:a,from:u,sn:f,desc:i,fnKey:l}=t,{key2InsKeys:d,id2InsKeys:p,insCtxMap:y,rootValKey:g}=n;let h=[],m=[],E=[],_=[];const A={};if(a){const S=me();Ve.set(S)}const w=(S,K=!1)=>{const{firstLevelFnKeys:T,asyncFnKeys:L}=ta(n,S,A,K);E=E.concat(T),_=_.concat(L)},I=S=>{if(!it(n,S))return;const K=d[S]||[],T=[];for(const L of K){if(h.includes(L))continue;const R=y.get(L);if(!R)continue;const C=R.getDeps();if(C[0]===g){it(n,g)&&T.push(L);continue}Or(n,C,S)&&T.push(L)}h=h.concat(T),w(S)};s.forEach(S=>I(S)),s.includes(g)||I(g),w(g,!0),ea(),r.forEach(S=>{h=h.concat(p[S]||[])}),o.forEach(S=>{fn(S).forEach(K=>b(m,K))}),h=Se(h),E=Se(E),_=Se(_),_.forEach(S=>vn(S,A[S]));const D=[],k={depKeys:s,sn:f,from:u,triggerReasons:c,watchFnKeys:D,skipWatch:!0,internal:n,desc:i,isFirstCall:a,fromFnKey:l};E.forEach(S=>Ie(S,k));const v={depKeys:s,sn:f,from:u,triggerReasons:c,internal:n,desc:i,isFirstCall:a,fromFnKey:l};if(D.forEach(S=>Ie(S,v)),h.forEach(S=>Sn(y,S,f)),m.length){const S=ca().insCtxMap;m.forEach(K=>Sn(S,K,f))}}function nu(e){const{state:t,internal:n,mutateCtx:r}=e,{rawState:o,isDeep:s,ver:c,snap:a}=n;s?(n.prevSnap=c===0?M({},a):a,n.snap=t,Object.assign(o,t)):n.snap=M({},o),n.ver+=1,n.sn=r.sn,tu(e)}var{MUTATE:co}=H;function ao(e,t){const{writeKey:n,ids:r,internal:o,opParams:s}=t,{snap:c}=o,{fullKeyPath:a,value:u}=s;Object.keys(e).forEach(f=>{n.startsWith(f)&&fe(c,a)!==u&&e[f].forEach(i=>b(r,i))})}function uo(e,t){var L;const{isChanged:n,fullKeyPath:r,keyPath:o,parentType:s,value:c}=e,{internal:a,mutateCtx:u}=t,{arrKeyDict:f,isReactive:i,readKeys:l,from:d}=u,{sharedKey:p}=a,y=Mr(s),g=se.current();if(e.op==="get"){y&&(f[$(o,p)]=1);const R=$(r,p);l[R]=1,u.enableDep&&(g.onRead?g.onRead(e):(Ge().fnCtx&&be([R],{sharedKey:p}),i&&(rn([R]),cn(p,c,a.sharedState,R,r)),(L=a.onRead)==null||L.call(a,e)));return}if(co===d){const{delPathAoa:R,fnCtx:C}=Ge();C&&R.push(o)}if(!n)return;const{moduleName:h,ruleConf:m,level1ArrKeys:E}=a,{writeKeyPathInfo:_,ids:A,globalIds:w,writeKeys:I}=u,D=$(r,p);if(g.key&&(g.isTop?b(g.writeKeys,D):g.from===co&&b(en(g.fnKey).subFnInfo.writeKeys||[],D)),y){const R=$(o,p);_[R]={sharedKey:p,moduleName:h,keyPath:o},I[R]=1}const{hasIds:k,hasGlobalIds:v,stopDepInfo:S}=m;_[D]={sharedKey:p,moduleName:h,keyPath:r};const K=Un(f,D);K&&(I[K]=1),Cr({sharedKey:p,keyPath:r,depKey:D},{stopDepInfo:S,level1ArrKeys:E,recordCb:R=>{I[R]=1}})||(I[D]=1),k&&ao(m.idsDict,{ids:A,writeKey:D,internal:a,opParams:e}),v&&ao(m.globalIdsDict,{ids:w,writeKey:D,internal:a,opParams:e}),i?pa(p,g.desc):da(p)}function io(e,t){Object.keys(t).forEach(n=>{e[n]=t[n]})}function Et(e,t){if(!t)return e;on(!0);const n=e.val;return on(!1),n}function fo(e){const{partial:t,forAtom:n,draftRoot:r,draftNode:o}=e;if(!t)return;if(!n){ye(t)&&io(o,t);return}const s=t.val;if(ye(o)){ye(s)?io(o,s):console.warn("dict atom deny to handle a non-dict returned value!");return}r.val=s}function ru(e,t){const{internal:n,mutateCtx:r}=e,o=Et(t,n.forAtom),{from:s,sn:c,desc:a}=r;n.before({from:s,draftRoot:t,draft:o,desc:a,sn:c}),ic(n,t,o,c)}function lo(e,t,n,r){const{mutateCtx:o,internal:s}=e,{writeKeys:c,writeKeyPathInfo:a,handleCbReturn:u}=o,{forAtom:f}=s;u&&fo({partial:r,forAtom:f,draftRoot:t,draftNode:n}),ru(e,t),o.depKeys=Object.keys(c),at.del(),Qt.del(),e.state=(0,X._x)(t),e.state!==s.rawState&&(o.triggerReasons=Object.values(a),nu(e),pc(s,o))}function po(e,t){const{ids:n,globalIds:r,from:o,desc:s,fnKey:c}=t;n&&n.forEach(a=>b(e.ids,a)),r&&r.forEach(a=>b(e.globalIds,a)),o&&(e.from=o),s&&(e.desc=s),c&&(e.fnKey=c)}function ou(e){const{internal:t,setFactoryOpts:n}=e,{forAtom:r,rawState:o}=t,s=Vt(n),c=(0,X.P2)(o,{autoRevoke:!1,customKeys:Ze,onOperate:u=>{if(u.isCustom)return an(u,r,t.sharedKey);uo(u,{internal:t,mutateCtx:s})}});at.set(c,r),Qt.set(s);const a=Et(c,r);return r&&(s.readKeys={}),{draftRoot:c,draftNode:a,finishMutate(u,f={}){po(s,f),lo({state:{},mutateCtx:s,internal:t},c,a,u)}}}function su(e){return lr(e),_c(e)}function cu(e){if(!e)return{};const{desc:t,ids:n,globalIds:r}=e;return{desc:t,ids:n,globalIds:r}}function au(e){const{forAtom:t=!1}=e;let n=e.rawState;const r=x(n);let o=!1;if(t)n=r?{val:n()}:{val:n},o=!n.val||!Nn(n.val);else{if(n=r?n():n,!J(n))throw new Error("ERR_NON_OBJ: pass an non-object to createShared!");if(oe(n))throw new Error("ERR_ALREADY_SHARED: pass a shared object to createShared!")}return{isPrimitive:o,rawState:n}}function yo(e,t,n){let r=null,o=t||"";if(x(e)&&e!==F)r={[zn]:1,fn:e,deps:Ke,oriDesc:o,onlyDeps:!1,desc:o,depKeys:[],writeKeys:[],checkDeadCycle:void 0,watchKey:"",isFake:!1,enabled:!0,extraBound:{state:{},stateRoot:{},isAtom:!1}};else if(J(e)){const{fn:s,desc:c,deps:a,task:u,immediate:f,checkDeadCycle:i,onlyDeps:l=!1}=e,d=t||c||"",p=x(s)?s:void 0,y=x(u)?u:void 0,g=x(a)?a:Ke;(s||u)&&(r={[zn]:1,checkDeadCycle:i,fn:p,watchKey:"",desc:d,oriDesc:d,deps:g,task:y,onlyDeps:l,immediate:f,depKeys:[],writeKeys:[],isFake:!1,enabled:!0,extraBound:{state:{},stateRoot:{},isAtom:!1}})}if(r&&n){const{oriDesc:s}=r;(!s||n[s])&&(r.desc=Bt(H.MUTATE))}return r}function ho(e,t,n=!0){const r={},o=t||{};if(!e)return r;const s=(c,a)=>{const u=yo(c,a,o);u&&(u.enabled=n,r[u.desc]=u,o[u.desc]=u)};if(Array.isArray(e))if(e.length===1){const c=e[0],a=(J(c)?c.desc:"")||Qe;s(e[0],a)}else e.forEach(c=>s(c));else x(e)?s(e,Qe):J(e)&&Object.keys(e).forEach(c=>{s(e[c],c)});return r}function uu(e,t={}){var v,S,K,T,L;const{forAtom:n=!1,forGlobal:r=!1,stateType:o=q.USER_STATE}=e,{rawState:s,isPrimitive:c}=au(e),a=su(s),u=t.moduleName||"",f=(v=t.alertDeadCycleErr)!=null?v:ue(),i=(S=t.deep)!=null?S:!0,l=(K=t.checkDeadCycle)!=null?K:!0,d=(T=t.enableMutate)!=null?T:!0,p=t.recordLoading||Ot.PRIVATE,y=t.rules||[],g=t.before||F,h=t.mutate||F,m=t.onRead||void 0,E=(L=t.stopArrDep)!=null?L:!0,_=t.stopDepth||Ws,A=`${a}`,w=n?`${a}/val`:A,I=u||A,D=Wc(u),k=ho(h,{},d);return{isDestroyed:!1,alertDeadCycleErr:f,checkDeadCycle:l,rawState:s,sharedKey:a,sharedKeyStr:A,rootValKey:w,moduleName:u,usefulName:I,forAtom:n,forGlobal:r,loc:D,deep:i,rules:y,before:g,mutate:h,mutateFnDict:k,onRead:m,enableMutate:d,stateType:o,recordLoading:p,stopArrDep:E,stopDepth:_,isPrimitive:c}}function iu(e){const{rawState:t,sharedKey:n,rootValKey:r,deep:o,rules:s,stopDepth:c,stopArrDep:a,forAtom:u}=e,f={},i={},l={keys:[],isArrDict:{},arrKeyStopDcit:{},depth:c,stopArrDep:a},d={},p=wt(o);s.forEach(h=>{const m=[],{when:E,ids:_=[],globalIds:A=[],stopDep:w}=h;let I;if(p){let K="";I=(0,X.OA)(t,{onOperate:({fullKeyPath:T,value:L,isBuiltInFnKey:R})=>{if(R)return;const C=$(T,n);K&&C.includes(K)&&m.pop(),m.push(C),d[C]=Array.isArray(L),K=C}})}else I=de(t,{set:Ms,get:(K,T)=>{const L=$([T],n);m.push(L);const R=K[T];return d[L]=Array.isArray(R),R}});const D=u?I.val:I,k=W(E,D),v=(K,T,L)=>{const R=Fe(K,L,[]);T.forEach(C=>b(R,C))},S=K=>{v(f,_,K),v(i,A,K);let T;d[K]?(T=w!=null?w:Xs,l.arrKeyStopDcit[K]=T,l.isArrDict[K]=d[K]):T=w!=null?w:!1,T&&b(l.keys,K)};m.forEach(S),k.includes(D)&&S(r)});const y=Object.keys(f).length>0,g=Object.keys(i).length>0;return{hasIds:y,idsDict:f,hasGlobalIds:g,globalIdsDict:i,stopDepInfo:l}}function fu(e){const{desc:t=Qe,strict:n=!1,throwErr:r=!1,extraArgs:o}={};return typeof e=="string"?{desc:e,strict:n,throwErr:r,extraArgs:o}:M({desc:t,strict:n,throwErr:r,extraArgs:o},e)}function go(e,t){var o;let n=F,r=!1;return x(t)?n=t:J(t)&&(n=t.deps||F,r=(o=t.immediate)!=null?o:!1),r=e?!0:r,{immediate:r,deps:n}}function lu(e){return e?typeof e=="boolean"?{enableStatus:e}:J(e)?e:{}:{}}function du(e){Array.isArray(e)&&e.forEach(t=>{const n=Zt.current(t),r=Y(t)||(n==null?void 0:n.internal);if(r){const{depKey:o,sharedKey:s}=wr(r);be([o],{sharedKey:s})}n&&n.recordDep(wr(r))})}function mo(e,t,n){const{deps:r,immediate:o}=go(e,n),s=vt(t,{scopeType:ne.STATIC,deps:r,immediate:o});return{run:c=>Ie(s.fnKey,{throwErr:c}),unwatch:()=>ft(s)}}function vt(e,t){const{scopeType:n,fnCtxBase:r,immediate:o,deps:s=F,label:c="watch",sharedState:a,isSimpleWatch:u}=t;if(!x(e))throw new Error(`ERR_NON_FN: pass an non-function to ${c}!`);const f=no(e,{specificProps:{scopeType:n,fnType:er,isSimpleWatch:u},fnCtxBase:r});gn(f.fnKey,oe(a));const i=s()||[];return du(i),o&&e({isFirstCall:!0}),me(),f}function pu(e,t){return mo(!1,e,t)}function yu(e,t){return mo(!0,e,t)}var Eo=()=>{},An=new Map;function vo(e,t){const{forAtom:n,rawState:r}=e,{deps:o,extraBound:s}=t;return n?W(o,r.val,s):W(o,r,s)}function hu(e){var t;return(t=An.get(e))!=null?t:!1}function Kn(e,t){const{sn:n,getArgs:r=F,from:o,throwErr:s,isFirstCall:c,fnItem:a,mergeReturn:u,extraArgs:f}=t,{desc:i="",depKeys:l,task:d=Eo,extraBound:p}=a,y=Y(e),{sharedKey:g}=y,h={desc:i,sn:n,from:o},m=hn(o,i),{draft:E,draftRoot:_}=dn(y,{depKeys:l,desc:i,from:o}),A=R=>{He(g,R)},w=R=>{A(i);const{finish:C}=y.setStateFactory(h);return C(R)},I=H.MUTATE===o?vo(y,a):[],D={isFirstCall:c,desc:i,setState:w,input:I,draft:E,draftRoot:_,flush:A,extraBound:p,extraArgs:f},k=r(D)||[D],v=An.get(d),S=v===void 0,K=(R,C,At)=>{(S||v)&&qr(y,m,{loading:R,err:C,ok:At})};K(!0,null,!1);const T=R=>{if(Ve.del(),K(!1,R,!1),s)throw R;return{snap:y.snap,err:R,result:null}},L=R=>(u&&R&&w(R),K(!1,null,!0),A(i),{snap:y.snap,err:null,result:R});try{const R=d(...k),C=bt(R);return An.set(d,C),C?Promise.resolve(R).then(L).catch(T):L(R)}catch(R){return T(R)}}function So(e,t){const{sn:n,getArgs:r=F,from:o,throwErr:s,isFirstCall:c=!1,fnItem:a,extraArgs:u}=t,{desc:f="",watchKey:i,fn:l=Eo,extraBound:d}=a,p=H.MUTATE===o;p&&Ue.set(i);const y=Y(e),{setStateFactory:g,forAtom:h,sharedRoot:m}=y,_={desc:f,sn:n,from:o,isFirstCall:c,enableDep:p&&c},A=K=>{const{finish:T}=g(_);return T(K)},w=Et(m,h),I=p?vo(y,a):[],{draftNode:D,draftRoot:k,finish:v}=g(_),S=r({draft:D,draftRoot:k,setState:A,desc:f,input:I,extraArgs:u})||[D,{input:I,state:w,draftRoot:k,isFirstCall:c,extraBound:d,extraArgs:u}];try{const K=en(a.watchKey);if(K.dcErrorInfo.err)return En(y,K.dcErrorInfo),{snap:y.snap,err:null,result:null};const T=l(...S);return v(T,{fnKey:K.fnKey}),Ao(y,a,c),{snap:y.snap,err:null,result:null}}catch(K){if(Ao(y,a,c),s)throw K;return{snap:y.snap,err:K,result:null}}}function Ao(e,t,n){n&&!t.onlyDeps&&(Ge().fnCtx?t.depKeys=me():t.depKeys=Ve.current(),Ve.del());const r=se.current();r.isTop&&r.fnKey===t.watchKey&&Ee(e,en(t.watchKey),r.writeKeys),Ue.del()}function gu(e,t){var r;la(),Ve.del(),on(!1);const n=Ge().fnCtx;n&&(n.subFnInfo=t,n.checkDeadCycle=(r=t.checkDeadCycle)!=null?r:e.checkDeadCycle,t.watchKey=n.fnKey),t.onlyDeps&&(t.depKeys=me())}function Dn(e){const{target:t,dict:n}=e,r=Object.keys(n),o={};if(!r.length)return o;const s=Y(t),{mutateFnDict:c,usefulName:a,forAtom:u,sharedRoot:f}=s,i=l=>fr(s,l);return r.forEach(l=>{const d=c[l];o[l]=vt(({sn:p,isFirstCall:y})=>{if(y&&gu(s,d),!s.enableMutate)return;const{desc:g,fn:h,task:m,immediate:E}=d,_=$a(a,g);try{if(_.isIn)throw oo(a,_.cycle,g);const A={sn:p,throwErr:!0,isFirstCall:y,fnItem:d,from:H.MUTATE};if(h&&(y||!m)&&So(t,A),m){y&&(d.depKeys=me());const w=y&&(E!=null?E:!h);(!y||w)&&Kn(t,A).catch(i)}return d}catch(A){A.cause==="DeadCycle"&&Wa(a,A,s.alertDeadCycleErr),i(A)}},{deps:()=>d.deps?d.deps(Et(f,u),d.extraBound)||[]:[],sharedState:t,scopeType:ne.STATIC,immediate:!0})}),o}var{ACTION:Ko}=H;function mu(e,t){const{label:n,throwErr:r,desc:o="",task:s,mergeReturn:c=!0}=t,a=tn(r,!1),u=he(e,{label:n}),{forAtom:f}=u,i=(l,d)=>{const p=tn(d,a),y=Yt({desc:o,task:s,depKeys:[]}),g=(h,m)=>h.__action?h.__action(m):h(m);return Kn(e,{fnItem:y,from:Ko,mergeReturn:c,throwErr:p,getArgs:({draft:h,draftRoot:m,setState:E,desc:_,flush:A})=>[{draft:h,draftRoot:m,setState:E,desc:_,payload:l,flush:A,merge:I=>{fo({partial:I,forAtom:f,draftRoot:m,draftNode:h})},dispatch:g}]})};return qr(u,hn(Ko,o),{loading:!1,ok:!0,err:null}),i.__sharedKey=u.sharedKey,i.__fnName=o,i.__task=s,s.__action=i,i}function Do(e){return t=>(n,r="",o)=>mu(e,{task:n,desc:r,label:"action",mergeReturn:t,throwErr:o})}var{TASK:_o}=tt,{STATIC:Eu,HOOK:vu}=ne;function Ro(e,t,n){if(!n&&(!J(t)||bt(t)))throw new Error("ERR_NON_OBJ: derive,deriveAsync expect result to be a plain object");const{isAsync:r,isAsyncTransfer:o}=e;if(r&&!o){const s=br(t),c=oe(t);if(s&&e.fnKey!==s||c)throw new Error("ERR_INVALID_CALL: derive,deriveAsync can not transfer another derived result or shared state, it will cause wrong result")}}function Su(e,t){const n=de(e.result,{set:()=>(De("changing derived result is invalid"),!1),get:(r,o)=>{if(o===Ce)return t;const s=r[o];return be(e.depKeys,{belongCtx:e}),rn(e.depKeys,n),cn(0,s,n,"",[o],!0,t),s}});return e.proxyResult=n,n}function To(e,t){const{result:n,isUpstream:r}=t,o=Ye(n);o&&(e.depKeys=Se(e.depKeys.concat(o.depKeys)),b(o.nextLevelFnKeys,e.fnKey),b(e.prevLevelFnKeys,o.fnKey),e.isFirstLevel=!1,r==null||r())}function Au(e){var k,v;const{scopeType:t=Eu,fnCtxBase:n,isAsyncTransfer:r=!1,asyncType:o=_o,returnUpstreamResult:s,runAsync:c=!0,forAtom:a=!1,immediate:u}=e;if(!x(e.fn))throw new Error("ERR_NON_FN: derive need fn arg!");const{fn:f=F,deps:i=F,task:l,stateRoot:d={}}=e,p=Te(d),y=(k=e.isAsync)!=null?k:x(l),g=(v=e.showLoading)!=null?v:y,h=no(f,{specificProps:{forAtom:a,scopeType:t,stateRoot:d,isStateAtom:p,fnType:qn,task:l,deps:i,isAsync:y,asyncType:o,isAsyncTransfer:r,showLoading:g},fnCtxBase:n});gn(h.fnKey,0);const{input:m,state:E}=so(i,d,p);m.forEach(S=>To(h,{result:S}));let A=f({isFirstCall:!0,prevResult:null,triggerReasons:[],input:m,sn:0,state:E,stateRoot:d,isAtom:p});me();const w=Ye(A);a&&!w&&(A={val:A,z__is_atom_result__:!0});const I=h.fnKey;Ro(h,A),To(h,{result:A,isUpstream:()=>{h.returnUpstreamResult=s!=null?s:!y}}),sn(h),h.returnUpstreamResult||Tr(A,t,I);const D=c&&o===_o&&(u!=null?u:!e.fn);return l&&D&&Ie(I,{isFirstCall:!0,sn:h.renderInfo.sn+1,throwErr:!0}).then(S=>{Ro(h,S[0],a)}).catch(S=>ie(S)),h.result=A,t===vu&&ro(h)&&h.setLoading(!0),h.returnUpstreamResult?h.proxyResult=A:Su(h,a),h}function _n(e,t){const n=x(e)?{fn:e}:e||{};return Au(M(M({},t||{}),n))}function bo(e,t){return _n(e,{forAtom:!0,stateRoot:t}).proxyResult}function Ku(e,t){return _n(e,{stateRoot:t}).proxyResult}function Du(e){return t=>j(M({},t),{deps:e})}function _u(e){return e}var St=e=>[e.snap,e.err];function Rn(e){const{target:t,desc:n="",forTask:r=!1,throwErr:o,extraArgs:s}=e,{mutateFnDict:c,snap:a}=Y(t),u=n||Qe,f=c[u];if(!f)return{snap:a,err:new Error(`mutate fn ${u} not defined`),result:null};if(r&&!f.task)return{snap:a,err:new Error(`mutate task ${u} not defined`),result:null};const i=tn(o,!1),l={sn:0,fnItem:f,from:H.MUTATE,throwErr:i,extraArgs:s};return r?Kn(t,l):So(t,l)}function Io(e,t){const{desc:n,oriDesc:r,internal:o,watchFnCtx:s}=t;return{run:c=>{const a=Rn({target:e,desc:n,throwErr:c});return St(a)},runTask:c=>Promise.resolve(Rn({target:e,desc:n,forTask:!0,throwErr:c})).then(St),cancel:()=>{ft(s),delete o.mutateFnDict[n]},desc:n,oriDesc:r,getSnap:()=>o.snap,snap:o.snap,__sharedKey:o.sharedKey}}function Ru(e){const{target:t,fnItem:n,label:r,extraTarget:o}=e,s=he(t,{label:r}),c=yo(n,"",s.mutateFnDict);if(!c)throw new Error("not a fn or fnItem { fn }");o&&(c.extraBound=Ut(o));const{desc:a,oriDesc:u}=c;s.mutateFnDict[a]=c,c.enabled=s.enableMutate;const f={[a]:c};let i;return s.enableMutate&&(i=Dn({target:t,dict:f})[a]),Io(t,{desc:a,oriDesc:u,internal:s,watchFnCtx:i})}function Tu(e){const{target:t,fnDict:n,label:r}=e,o=he(t,{label:r}),s=ho(n,o.mutateFnDict,o.enableMutate);if(e.extraTarget){const u=Ut(e.extraTarget);Object.keys(s).forEach(f=>s[f].extraBound=u)}let c={};o.enableMutate&&(c=Dn({target:t,dict:s}));const a={};return Object.keys(s).forEach(u=>{a[u]=Io(t,{desc:u,oriDesc:u,internal:o,watchFnCtx:c[u]})}),a}function bu(e,t){const{label:n,descOrOptions:r,forTask:o=!1}=t,{desc:s,strict:c,throwErr:a,extraArgs:u}=fu(r);return s?zr(e,{label:n,strict:c})?{ok:!0,desc:s,forTask:o,throwErr:a,extraArgs:u,err:null}:{ok:!1,desc:s,forTask:o,throwErr:a,extraArgs:u,err:new Error("not a valid atom or shared result")}:{ok:!1,desc:s,forTask:o,throwErr:a,err:new Error("miss desc")}}function wo(e,t){const{ok:n,desc:r,forTask:o,err:s,throwErr:c,extraArgs:a}=bu(e,t);if(!n){if(c)throw s;return o?Promise.resolve([e,s]):[e,s]}const u=Rn({target:e,desc:r,forTask:o,throwErr:c,extraArgs:a});return o?Promise.resolve(u).then(St):St(u)}function Mo(e,t){return wo(e,{descOrOptions:t,label:"runMutate"})}function Fo(e,t){return wo(e,{descOrOptions:t,label:"runMutateTask",forTask:!0})}function ko(e,t){return n=>Ru({target:e,extraTarget:t,fnItem:n,label:"mutate"})}function Tn(e,t){return n=>Tu({target:e,extraTarget:t,fnDict:n,label:"mutateDict"})}function Iu(e){return e}function Co(e,t,n={}){const{tuple:r}=pt(e,t,n);return r}function Oo(e,t,n={}){const{tuple:r}=pt(e,t,n),[o,s,c]=r;return j(M({},c),{state:o,setState:s})}var wu="ERR_NOT_DERIVED_RESULT: useDerived only accept derived result",Mu="ERR_NOT_ATOM_RESULT: useDerivedAtom only accept derived atom";function Fu(e,t,n){return e.isExpired?(e.isExpired=!1,!0):x(n)?!1:n!==t}function ku(e){mn(e),e.depKeys.length=0,e.prevLevelFnKeys.length=0,e.renderInfo.sn+=1}function Cu(e,t){const{result:n,forAtom:r,showLoading:o}=t,{fnCtx:s,input:c,deriveFn:a}=e;let u=!1;if(a){if(!Fu(s,c,n))return;u=!0,ku(s)}e.input=n;const f=Ye(n);if(!f)throw new Error(wu);if(r&&!le(n))throw new Error(Mu);e.deriveFn=()=>f.result,_n({fn:()=>f.result,deps:()=>[],task:()=>Ks(this,null,function*(){return f.result})},{isAsync:f.isAsync,scopeType:ne.HOOK,fnCtxBase:s,isAsyncTransfer:!0,runAsync:!1,returnUpstreamResult:!0,forAtom:r,asyncType:tt.MAY_TRANSFER,showLoading:o}),$r(s),u&&s.updater()}function xo(e,t){const{result:n,forAtom:r}=t,{hookImpl:o,react:s}=e,c=o.useForceUpdate(),{current:a}=s.useRef({input:n,deriveFn:null,fnCtx:null});a.fnCtx||(a.fnCtx=yt({updater:c,scopeType:ne.HOOK,forAtom:r}));const u=a.fnCtx;return u.renderStatus=Oe,Cu(a,t),u}function Ou(e,t){t.shouldReplaceResult&&($r(t),t.shouldReplaceResult=!1),dt(e,t.subscribe,()=>Lr(t)),e.react.useEffect(()=>{t.renderStatus=Lt})}function Lo(e,t){e.react.useEffect(()=>(t.mountStatus=et,xr(t),()=>{mn(t)}),[t])}function bn(e,t){const n=xo(e,t);return dt(e,n.subscribe,()=>Lr(n)),Lo(e,n),n}function xu(e,t){const n=xo(e,t);return Ou(e,n),Lo(e,n),n}function In(e,t,n){const r=xu(e,M({result:t},n||{})),{proxyResult:o,status:s,renderInfo:c}=r;return[le(t)?o.val:o,s,c]}function Po(e,t,n){if(t===null)return n;if(!x(t))return null;const{sharedState:r,forAtom:o}=e,s=o?r.val:r,c={};Jt.set(u=>c[u[0]]=1);const a=W(t,s);return Jt.del(),a.includes(s)?e.key2InsKeys:c}function No(e,t,n){const r=he(t),[o]=e.react.useState(()=>Po(r,n,null));return s=>{const{insCtxMap:c,key2InsKeys:a}=r,u=Po(r,s,a)||o||a,f={};if(Object.keys(u).forEach(l=>{(a[l]||[]).forEach(p=>f[p]=1)}),Object.keys(f).length){r.sn+=1;const l=r.sn;Object.keys(f).forEach(d=>{Sn(c,Number(d),l)})}}}function Lu(e,t){kn(e);const n=un();return yn(e,n,{collectType:"no",globalId:t}).renderInfo}var{ACTION:Uo,MUTATE:Bo}=H;function wn(e,t){kn(e);const{target:n,from:r="Mutate"}=t||{};let o=Qr();n&&(o=he(n));const{loadingProxy:s,loadingState:c}=$e(ce,{apiCtx:e,internal:o,from:r});return{loadingProxy:s,loadingState:c,internal:o,from:r}}function Vo(e,t){const{loadingProxy:n,internal:r,from:o}=wn(e,t),{proxyState:s,extra:c,renderInfo:a}=yn(e,n);return[ge(c,s,o),r.setState,a]}function Pu(e,t){const{loadingProxy:n}=wn(e,{target:t,from:Bo});return n}function Nu(e,t){return Vo(e,{target:t,from:Bo})}function Uu(e,t){const{loadingProxy:n}=wn(e,{target:t,from:Uo});return n}function Bu(e,t){return Vo(e,{target:t,from:Uo})}function Yo(e){return e.hookImpl.useForceUpdate()}function Go(e,t){const n=(r,o)=>{let s=null;if(x(r)){const c=(0,X.P2)(o,{autoRevoke:!1}),a=r(c);s=(0,X._x)(c),J(a)&&Object.assign(s,a)}else J(r)&&(s=M(M({},o),r));return s};return e.hookImpl.useObjectLogic(t,n,!0)}function Vu(e,t,n){const{useRef:r,useMemo:o,useEffect:s}=e.react,c=r({fn:n,wrap:null});c.current.fn=o(()=>n,[n]),c.current.wrap||(c.current.wrap=(...a)=>{c.current.fn(...a)}),s(()=>{const a=hc(),u=c.current.wrap;return a.on(t,u),()=>a.off(t,u)},[t,c])}function Mn(e,t,n={}){const r=Te(t),{insCtx:o}=pt(e,t,j(M({},n),{forAtom:r,isReactive:!0}));return[o.proxyStateVal,o.proxyState,o.renderInfo]}function jo(e,t,n={}){const[r,o,s]=Mn(e,t,n);return j(M({},s),{state:r,stateRoot:o})}function Yu(e,t,n){const r=J(n)?n:{};e.react.useEffect(()=>{const{srvRef:o}=r;x(o)&&o(t)},[])}function Gu(e,t,n){const r=e.hookImpl.useStable(t);return Yu(e,r,n),r}function ju(e){return t=>e.current=t}var{HOOK:Ho}=ne;function $o(e,t){e(()=>{var n,r;return t.mountStatus=et,xr(t),(r=(n=t.extra).deferedWatch)==null||r.call(n),()=>{mn(t)}},[t])}function Wo(e,t){const{useRef:n,useState:r,useMemo:o,useEffect:s}=e.react,{label:c,forEffect:a,watchFn:u,watchOptions:f}=t,i=n({fn:u,wrap:null,fnKey:"",isDeferMarked:!1}),[l]=r(()=>yt());if(i.current.fn=o(()=>u,[u]),!i.current.wrap){const{deps:d,immediate:p}=go(a,f);i.current.wrap=g=>{if(l.mountStatus===et){i.current.fn(g);return}l.extra.deferedWatch=()=>{if(i.current.isDeferMarked){i.current.fn(g);return}i.current.isDeferMarked=!0,gn(i.current.fnKey,0),i.current.fn(g),me()}};const{fnKey:y}=vt(i.current.wrap,{scopeType:Ho,fnCtxBase:l,deps:d,immediate:p,label:c});i.current.fnKey=y}$o(s,l)}function Hu(e,t,n){const{useState:r,useEffect:o}=e.react,[s]=r(()=>yt());if(s.fn===F){const{manualDepKeys:c=[]}=n;vt(t,{scopeType:Ho,fnCtxBase:s,deps:()=>c.map(u=>{const{sharedKey:f,keyPath:i}=Ir(u),l=Tc(f);return fe(l,i)}),isSimpleWatch:!0})}$o(o,s)}function $u(e,t,n){Wo(e,{label:"useWatch",forEffect:!1,watchFn:t,watchOptions:n})}function Wu(e,t,n){Wo(e,{label:"useWatchEffect",forEffect:!0,watchFn:t,watchOptions:n})}function Xu(e){const{internal:t,setFactoryOpts:n}=e,{rawState:r,forAtom:o,stopDepth:s,sharedKey:c}=t,a=Vt(n),u=M({},r),f=(p,y,g,h)=>{const m=Ne(y,g,{parentType:Fr(p),parentKeyPath:h});uo(m,{internal:t,mutateCtx:a}),Vn(u,m.fullKeyPath,g)},i=(p,y,g)=>xe(p,{set:(h,m,E)=>(f(h,m,E,g),!0),get:(h,m)=>{const E=h[m];if(Ze.includes(m))return lt(y===1,o,c,m,E);const _=Ne(m,E,{isChanged:!1,parentKeyPath:g,op:"get",parentType:Fr(h)});return y<s&&ye(E)?i(E,y+1,_.fullKeyPath):fe(u,_.fullKeyPath)}}),l=i(u,1,[]);at.set(l,o),Qt.set(a);const d=o?l.val:l;return{draftRoot:l,draftNode:d,finishMutate(p,y={}){po(a,y);const g=M({state:{},mutateCtx:a},e);lo(g,l,d,p)}}}function zu(e){let t=e;if(e){e.persist&&e.persist();const{currentTarget:n}=e;n&&e.type?n.tagName==="INPUT"&&n.type==="checkbox"?t=n.checked:t=n.value:e.nativeEvent&&e.target&&(t=e.target.value)}return t}function Ju(e){let t=[];return{target:zc(e,({fullKeyPath:r})=>{t=r}),getPath:()=>t}}function Xo(e,t,n){return o=>{let s=zu(o);e(c=>{const{isAtom:a,draftRoot:u}=at.current(),f={draft:c,draftRoot:u,path:t,isAtom:a,UNDEFINED:Hs},i=n==null?void 0:n(s,f);Vn(u,t,i!==void 0?i:s)},{from:H.SYNC})}}function Fn(e,t){const{sharedKey:n,innerSetState:r}=t;let o=$(e,n),s=zo.get(o);return s||(s=Xo(r,e),zo.set(o,s)),s}var zo=new Map;function Jo(e){const{forAtom:t,rawState:n}=e;return t?Nn(n.val)?xe(n.val,{get:(r,o)=>Fn(["val",o],e)}):Fn(["val"],e):xe(n,{get:(r,o)=>Fn([o],e)})}var Zo=new Map;function Qo(e){const{forAtom:t,sharedKey:n,innerSetState:r,rawState:o}=e,s=Ju(o);return(c,a)=>{let u=[];if(Array.isArray(c))u=t?["val",...c]:c;else{const{target:l,getPath:d}=s;c(t?l.val:l),u=d()}let f=$(u,n);a&&(f+=`${a.toString()}`);let i=Zo.get(f);return i||(i=Xo(r,u,a),Zo.set(f,i)),i}}function Zu(e,t,n){const{deep:r,forAtom:o,sharedKey:s}=n,c=iu(n),a=wt(r),u=(m={})=>{const E={internal:h,setFactoryOpts:m},{finishMutate:_,draftRoot:A,draftNode:w}=a?ou(E):Xu(E);return{finish:(I,D={})=>{const k=h.snap;if(I===k)return k;const v=Zc(o,I,w);return _(v,D),h.snap},draftRoot:A,draftNode:w}},f=(m={})=>u(m),i=(m,E={})=>u().finish(m,E),l=(m,E)=>{const[_,A,w]=E;return ln(e,Be.current(s)),u({handleCbReturn:_,enableDep:A}).finish(m,cu(w))},h=mr(n,{sharedRoot:e,sharedState:t,setState:(m,E)=>l(m,[!0,!0,E]),setDraft:(m,E)=>l(m,[!1,!0,E]),insSetState:(m,E)=>l(m,[!0,!1,E]),insSetDraft:(m,E)=>l(m,[!1,!1,E]),setStateFactory:f,innerSetState:i,ruleConf:c,isDeep:a});return h.sync=Qo(h),h.syncer=Jo(h),Kc(e,h),h}function Qu(e,t){const n=uu(e,t),{sharedRoot:r,sharedState:o}=oa(n),s=Zu(r,o,n);bc(r,n),jc(),Dn({target:r,dict:n.mutateFnDict});const{draft:c,draftRoot:a}=dn(s,{isTop:!0});return s.reactive=c,s.reactiveRoot=a,Ac(n.moduleName,s.loc),Ga(s.usefulName),yc(s),{sharedRoot:r,sharedState:o,internal:s,parsedOptions:n}}var{USER_STATE:qo}=q,{MUTATE:qu,ACTION:es}=H;function kn(e,t){qo===(t||qo)&&!un()&&(sa(e,ce),Ua(e,ce))}function ts(e,t){const{createFn:n,ldAction:r,actionDict:o,actionCreator:s,internal:c,apiCtx:a,forTp:u=!1}=e;$e(n,{internal:c,from:es,apiCtx:a});const f={},i={};return Object.keys(o).forEach(l=>{const d=o[l],p=u?d.__task:d,y=s(!1)(p,l,t);y.__fnName=l,i[l]=y;const g=(...h)=>{const m=y(...h);return hu(p)?Promise.resolve(m).then(E=>E.result):m.result};g.__fnName=l,f[l]=g}),{actions:f,eActions:i,getLoading:()=>r.getLoading(f),useLoading:()=>r.useLoading(f)[0],useLoadingInfo:()=>r.useLoading(f)}}function ns(e,t,n){const{state:r,stateRoot:o,isAtom:s}=e,c=Ut(n);return x(t)?t({state:r,stateRoot:o,isAtom:s,extraBound:c}):t}function rs(e){const{common:t,ldMutate:n,mutateFnDict:r,extra:o}=e,s=ns(t,r,o),c=Tn(t.stateRoot,o)(s);return{witnessDict:c,getLoading:()=>n.getLoading(c),useLoading:()=>n.useLoading(c)[0],useLoadingInfo:()=>n.useLoading(c)}}function ei(e){const{common:t,ldMutate:n,inital:r,mutateFnDict:o}=e,{stateRoot:s,useState:c,state:a,isAtom:u}=ss(t.apiCtx,r),f=j(M({},t),{stateRoot:s,state:a,isAtom:u,internal:Y(s)}),i=rs({common:f,ldMutate:n,mutateFnDict:o,extra:t.stateRoot});return M({derivedState:s,useDerivedState:c},i)}function ti(e){const{common:t,deriveFnDict:n,throwErr:r}=e,o=ns(t,n),{apiCtx:s,stateRoot:c}=t,a={},u={};return Object.keys(o).forEach(i=>{const l=bo(o[i],c);a[i]=l,u[i]={runDerive:d=>Qa(l,d!=null?d:r),runDeriveTask:d=>qa(l,d!=null?d:r),useDerived:d=>In(s,l,d)[0],useDerivedInfo:d=>In(s,l,d)}}),{result:new Proxy(a,{get:(i,l)=>a[l].val}),helper:u}}function ni(e,t){if(t.enableMutate=e,e){const{mutateFnDict:n}=t,r={};Object.keys(n).forEach(o=>{const s=n[o];s.enabled||(s.enabled=!0,r[o]=s)}),Tn(t.sharedState)(r)}}function ri(e){const{moduleName:t,deep:n,recordLoading:r,stopDepth:o,stopArrDep:s,alertDeadCycleErr:c,checkDeadCycle:a,enableMutate:u}=e;return{moduleName:t,deep:n,recordLoading:r,stopDepth:o,stopArrDep:s,alertDeadCycleErr:c,checkDeadCycle:a,enableMutate:u}}function ce(e,t){const{stateType:n,apiCtx:r}=e;kn(r,n);const{sharedRoot:o,sharedState:s,internal:c}=Qu(e,t),{syncer:a,sync:u,forAtom:f,setState:i,setDraft:l,sharedKey:d,sharedKeyStr:p,rootValKey:y,reactive:g,reactiveRoot:h}=c,m=Do(o),E=m(),_={internal:c,from:qu,apiCtx:r},A=ce,w=to(A,j(M({},_),{from:es})),I=to(A,_),D={createFn:A,internal:c,apiCtx:r,state:s,stateRoot:o,isAtom:f},k=j(M({},D),{ldAction:w,actionCreator:m});return{state:s,stateVal:s,stateRoot:o,setState:i,setDraft:l,setEnableMutate:v=>ni(v,c),getOptions:()=>ri(c),defineActions:v=>S=>ts(j(M({},k),{actionDict:S}),v),defineTpActions:v=>S=>ts(j(M({},k),{actionDict:S,forTp:!0}),v),defineMutateDerive:v=>S=>ei({common:D,ldMutate:I,inital:v,mutateFnDict:S}),defineMutateSelf:()=>v=>rs({common:D,ldMutate:I,mutateFnDict:v}),defineFullDerive:v=>S=>ti({common:D,deriveFnDict:S,throwErr:v}),mutate:ko(o),runMutate:v=>Mo(o,v),runMutateTask:v=>Fo(o,v),action:m,call:(v,S,K,T)=>E(v,K,T)(S),useState:v=>Co(r,o,v),useStateX:v=>Oo(r,o,v),useForceUpdate:v=>No(r,o,v),useLocalState:v=>Go(r,v),useLocalForceUpdate:()=>Yo(r),getMutateLoading:I.getLoading,useMutateLoading:I.useLoading,getActionLoading:w.getLoading,useActionLoading:w.useLoading,getSnap:v=>gr(o,v),sync:u,syncer:a,sharedKey:d,sharedKeyStr:p,rootValKey:y,reactive:g,reactiveRoot:h,reactiveDesc:v=>Vr(o,v),useReactive:v=>Mn(r,o,v),useReactiveX:v=>jo(r,o,v),flush:v=>ln(o,v),isAtom:f}}function os(e,t,n){const r=ce({apiCtx:e,rawState:t},n);return[r.stateRoot,r.setState,r]}function ss(e,t,n){return ce({apiCtx:e,rawState:t},n)}function oi(e,t,n){const r=ce({apiCtx:e,rawState:t,forAtom:!0},n);return[r.stateRoot,r.setState,r]}function si(e,t,n){return ce({apiCtx:e,rawState:t,forAtom:!0},n)}function cs(e,t){const{label:n,isSyncer:r}=t,o=he(e,{label:n});return(r?Jo:Qo)(o)}function ci(e){return cs(e,{label:"sync"})}function ai(e){return cs(e,{label:"syncer",isSyncer:!0})}var ui=100,ii=5e3;function fi(e,t){return{key:e,results:[],depKeys:[],enableStatus:t,collected:!1,mounted:!1,renderAtomOnce:!1,time:0,status:{loading:!1,err:null,ok:!0}}}function li(e,t=!1){const n=ee();e&&(n.initCount+=1);const r=Fc(),o=fi(r,t);return Q||Pr(e).set(r,o),o}function di(e){const t=ee();e.mounted=!0,e.time=Date.now(),t.mountedCount+=1}function pi(e,t){const n=ee(),r=Pr(t);if(r.delete(e),t&&r.size===ui&&n.initCount-n.mountedCount>2){n.initCount=0,n.mountedCount=0;const o=Date.now();r.forEach((s,c)=>{!s.mounted&&o-s.time>ii&&r.delete(c)})}}function yi(e,t){const n=ee();n.runningKey=e.key,n.isDynamic=t}function hi(e){const t=ee();t.runningKey="",t.isDynamic=!1,e.collected=!0}function gi(e,t,n){Hu(e,n,{manualDepKeys:t.depKeys})}function as(e,t,n){let r={loading:!1,err:null,ok:!0};return gi(e,t,n),t.results.forEach(o=>{const s=bn(e,{result:o,forAtom:le(o),showLoading:t.enableStatus});s.status.ok||(r=s.status)}),r}function us(e,t,n){e.react.useEffect(()=>(t.mounted||di(t),()=>{pi(t.key,n)}),[t])}var mi=()=>!0,Cn=e=>e;function Ei(e){const t=[];for(let n=1;n<=e.length;n++)t.push(e.slice(0,n));return t}function On(e,t,n,r,o){const s=t;return s.displayName=n,r?e.react.memo(s,o):s}function is(e,t){const{sharedState:n,depKey:r,keyPath:o,compare:s,sharedKey:c,format:a=Cn}=t;return On(e,function(){const f=yn(e,n,{arrDep:!0});f.isFirstRender&&(o.length>=2?Ei(o).forEach(d=>{f.recordDep({sharedKey:c,depKey:$(d,c),keyPath:d,parentKeyPath:d.slice(0,d.length-1)},nt)}):f.recordDep({sharedKey:c,depKey:r,keyPath:o}));const i=fe(f.internal.rawState,o);return a(i)},"HeluxSignal",!0,s)}function xn(e,t){return On(e,function(){const{result:r,format:o=Cn}=t,s=bn(e,{result:r,forAtom:!0});return o(s.proxyResult.val)},"HeluxDerivedAtomSignal",!0,t.compare)}function vi(e,t){return On(e,function(){const{result:r,keyPath:o,format:s=Cn}=t;return bn(e,{result:r,forAtom:!1}),s(fe(r,o))},"HeluxDerivedSignal",!0,t.compare)}function fs(e,t){const{isDynamic:n,cb:r,props:o,ref:s}=t,{collected:c,status:a}=e;c||yi(e,n);const f=r(o,{props:o,status:a,read:_s,ref:s})||"";return c||hi(e),f}function ls(e,t,n){const r=le(n);if(t.renderAtomOnce&&!r)throw new Error("block cb once returned derived atom but not keep to return it in new render period!");if(r){t.renderAtomOnce=!0;const o=xn(e,{result:n});return e.react.createElement(o,{status:{loading:!1,err:null,ok:!0}})}return tr(n)}function ds(e,t,n,r){const{memo:o=!0,compare:s}=r||{},{key:c}=t,{react:a}=e,u=a.forwardRef||F,f=n();let i=u(f);ue()&&(f.displayName="HeluxKeyedBlockForHMR",i=u((d,p)=>(p&&ws(p,"current")&&(t.ref=p),a.createElement(f,j(M({},d),{key:c})))));const l=o?a.memo(i,s):i;return l.displayName="HeluxBlock",l[xt]=!0,l}function Si(e,t){const{cb:n,isDynamic:r,apiCtx:o,blockCtx:s}=e,{useForceUpdate:c}=o.hookImpl,a=r?us:F;return ds(o,s,()=>(u,f)=>{const i=s.ref||f,l=fs(s,{isDynamic:r,cb:n,props:u,ref:i}),d=c();return as(o,s,d),a(o,s,r),ls(o,s,l)},t)}function Ai(e,t){const{cb:n,isDynamic:r,apiCtx:o,blockCtx:s}=e,c=r?us:F,{useForceUpdate:a}=o.hookImpl,{useEffect:u}=o.react;return ds(o,s,()=>(f,i)=>{const l=s.ref||i,d=fs(s,{isDynamic:r,cb:n,props:f,ref:l}),p=a(),y=as(o,s,p);c(o,s,r);const g=s.status.loading,h=y.loading;return u(()=>{g!==h&&p()},[g,h]),s.status=y,ls(o,s,d)},t)}function ps(e,t){const n=lu(t),{enableStatus:r}=n,o=j(M({},e),{blockCtx:li(e.isDynamic,r)});return r?Ai(o,n):Si(o,n)}function Ki(e,t,n){return ps({apiCtx:e,isDynamic:!1,cb:t},n)}function ys(e,t,n){return ps({apiCtx:e,isDynamic:!0,cb:t},n)}function hs(e,t,n){const{react:r}=e;if(t&&t[xt])return r.createElement(t);const o=mi;if(x(t)){const d=ys(e,t,{compare:o});return r.createElement(d)}if(le(t)){const d=xn(e,{result:t,compare:o,format:n});return r.createElement(d)}if(Te(t)){const d=oe(t),p=It("val",d),g=is(e,{sharedKey:d,sharedState:t,depKey:p,keyPath:["val"],compare:o,format:n});return r.createElement(g)}const s=ra(),{sharedKey:c,val:a,stateOrResult:u,depKey:f,keyPath:i,isDerivedResult:l}=s;if(t===a&&u){if(s.isDerivedAtom){const p=xn(e,{result:u,compare:o,format:n});return r.createElement(p)}if(l){const p=vi(e,{result:u,keyPath:i,compare:o,format:n});return r.createElement(p)}const d=is(e,{sharedKey:c,sharedState:u,depKey:f,keyPath:i,compare:o,format:n});return r.createElement(d)}return t}var{shallowCompare:Di,isDiff:_i,isDraft:Ri}=X.limuUtils,Ti=os,bi=hs,Ii={EVENT_NAME:Ct,RECORD_LOADING:Ot,VER:$n,LIMU_VER:Vs};function gs(e,t,n){return t(e,n)}function wi(e,t){return gs(e,t)}function Mi(e,t){return{build:n=>gs(e,t,n)}}var Fi=["atom","atomx","share","sharex","getMutateLoading","getActionLoading","$","signal","block","blockStatus","dynamicBlock","dynamicBlockStatus"];function ki(e){return e.startsWith("use")||Fi.includes(e)}function Ci(e){return Object.assign({useSyncExternalStore:F},e)}function Oi(e,t){const n=Ns(e),r=M({},n),o={react:Ci(e),hookImpl:n,act:t};t&&(n.useForceUpdate=()=>{const[,a]=e.useState({});return()=>t(()=>a({}))});const s=Hn;return Object.keys(s).forEach(a=>{const u=s[a];ki(a)?r[a]=u.bind(null,o):r[a]=u}),Object.assign({model:a=>wi(r,a),modelFactory:a=>Mi(r,a)},r)}function xi(e){const{inited:t,API:n}=cc();if(t)return n;const{heluxCtxKey:r,standalone:o,transfer:s,reactLib:c,act:a}=e,u=Z[r],f=(i,l)=>{const d=l||rr(),p=Oi(c,a);return ar({ROOT:d,inited:!0,api:p}),Z[i]=d,p};if(!u)return f(r);if(o)return f(`${String(r)}_${Date.now()}`);if(s){const i=rr();ar({ROOT:i,inited:!0}),s(u,i)}return f(r,u)}var Li=P(70079),Pi=P.t(Li,2),ms=xi({heluxCtxKey:"__HELUX__",reactLib:Pi}),Ni=ms.share,{atom:Ui,atomx:Bi,share:Vi,sharex:Yi,derive:Gi,deriveDict:ji,defineDeriveTask:Hi,defineDeriveFnItem:$i,runDerive:Wi,runDeriveTask:Xi,watch:zi,watchEffect:Ji,useAtom:Zi,useAtomX:Qi,useReactive:qi,useReactiveX:ef,useDerived:tf,useWatch:nf,useWatchEffect:rf,useGlobalId:of,useService:sf,useOnEvent:cf,useMutable:af,useMutateLoading:uf,useActionLoading:ff,useEffect:lf,useLayoutEffect:df,useStable:pf,useObject:yf,useLocalForceUpdate:hf,useGlobalForceUpdate:gf,action:mf,signal:Ef,block:vf,dynamicBlock:Sf,$:Af,mutate:Kf,mutateDict:Df,runMutate:_f,runMutateTask:Rf,defineMutateFnItem:Tf,sync:bf,syncer:If,model:wf,modelFactory:Mf,emit:Ff,on:kf,init:Cf,reactiveDesc:Of,flush:xf,isAtom:Lf,isSharedState:Pf,isDerivedAtom:Nf,isDerivedResult:Uf,isDraft:Bf,storeSrv:Vf,shallowCompare:Yf,markRaw:Gf,isDiff:jf,produce:Hf,getMutateLoading:$f,getActionLoading:Wf,getDeriveLoading:Xf,getRawState:zf,getSnap:Jf,getAtom:Zf,addMiddleware:Qf,addPlugin:qf,cst:el}=ms}}]);
}());