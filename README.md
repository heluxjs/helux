# [concent, ç‚¹å‡»äº†è§£æ›´å¤š](https://concentjs.github.io/concent-site/)
<p align="center">
  <a href="#">
    <img width="500" src="https://raw.githubusercontent.com/concentjs/concent-site/master/img/banner.png">
  </a>
</p>

<br/>

<!--- é¢å¤–åŒ…ä¸€ä¸ªpæ ‡ç­¾ï¼Œé˜²æ­¢æŸäº›mdè§£æå™¨è‡ªå·±åŒ…ä¸€ä¸ªpæ ‡ç­¾ï¼Œè¿›è€Œç ´åæ ·å¼ --->
<div style="display:flex; flex-wrap: wrap">

  <a href='https://www.npmjs.com/package/concent' style='margin: 0 0.5rem;'>
  <img src='https://img.shields.io/github/package-json/v/concentjs/concent/master.svg?label=npm%20version' alt='npm version' height='18'>
  </a>

  <a href='#' style='margin: 0 0.5rem;'>
  <img src='https://img.shields.io/github/issues/concentjs/concent.svg' alt='issues open' height='18'>
  </a>

  <a href='#' style='margin: 0 0.5rem;'>
  <img src='https://img.shields.io/npm/dw/concent.svg?label=downloads' alt='downloads' height='18'>
  </a>

  <a href='#' style='margin: 0 0.5rem;'>
  <img src='https://img.shields.io/github/last-commit/concentjs/concent.svg' alt='last commit' height='18'>
  </a>

  <a href='#' style='margin: 0 0.5rem;'>
  <img src='https://img.shields.io/github/commit-activity/m/concentjs/concent.svg' alt='commit activity' height='18'>
  </a>

  <a href='#' style='margin: 0 0.5rem;'>
    <img src='https://raw.githubusercontent.com/fantasticsoul/static/master/img/cc-svg/build.png' alt='build:passing' height='18'>
  </a>

  <a href='#' style='margin: 0 0.5rem;'>
  <img src='https://img.shields.io/npm/l/concent.svg' alt='license:MIT' height='18'>
  </a>

  <a href='#' style='margin: 0 0.5rem;'>
  <img src='https://img.shields.io/david/dev/concentjs/concent.svg' alt='dev dependencies' height='18'>
  </a>

  <a href='#' style='margin: 0 0.5rem;'>
  <img src='https://img.shields.io/bundlephobia/minzip/concent/1.4.1.svg' alt='mini bundle size' height='18'>
  </a>

  <a href='#' style='margin: 0 0.5rem;'>
  <img src='https://img.shields.io/github/package-json/dependency-version/concentjs/concent/co.svg' alt='co version' height='18'>
  </a>

  <a href='#' style='margin: 0 0.5rem;'>
  <img src='https://img.shields.io/github/followers/fantasticsoul.svg?style=social' alt='followers' height='18'>
  </a>

  <a href='#' style='margin: 0 0.5rem;'>
  <img src='https://img.shields.io/github/stars/concentjs/concent.svg?style=social' alt='concent star' height='18'>
  </a>

</div>




## concentæ˜¯ä»€ä¹ˆï¼Œï¼ˆæ³¨ï¼šä»¥ä¸‹æœ‰çš„åœ°æ–¹ç®€ç§°ä¸ºccï¼‰
concentæ˜¯ä¸€ä¸ªä¸“ä¸º`react`æä¾›çŠ¶æ€ç®¡ç†æœåŠ¡çš„æ¡†æ¶ï¼Œé‡æ–°å®šä¹‰`state`å’Œ`component`ä¹‹é—´çš„å…³ç³»ï¼ŒåŒæ—¶ä¹Ÿä¸ºä½ çš„`react`ç»„ä»¶æä¾›æ›´å¤šæœ‰è¶£ä¸”å¼ºå¤§çš„ç‰¹æ€§ï¼Œä¿æŒæ¸²æŸ“æ€§èƒ½æœ€ä¼˜åŒ–ï¼Œè®©ä½ ä¸“æ³¨äºä¸šåŠ¡ä»£ç ç¼–å†™ğŸ˜ï¼Œè®©ä½ çš„`react`å·¥ç¨‹ä»£ç å˜å¾—æ›´åŠ ç®€çº¦ã€ä¼˜é›…ï¼Œå¹¶å®¹æ˜“ç»´æŠ¤ä¸æ‰©å±•ã€‚

## âœ¨concentçš„ç‰¹ç‚¹
* æ ¸å¿ƒapiå°‘ä¸”ç®€å•ï¼ŒåŠŸèƒ½å¼ºå¤§ï¼Œä¸Šæ‰‹å®¹æ˜“ï¼Œå…¥ä¾µå°ï¼Œå®¹æ˜“è°ƒè¯•ï¼›
* æä¾›å…¨å±€æ¨¡å—åŒ–çš„å•ä¸€æ•°æ®æºï¼›
* å…±äº«æ•°æ®å¯ç›´æ¥æ³¨å…¥åˆ°stateï¼Œä¹Ÿå¯æ³¨å…¥propsï¼Œ[ç‚¹æˆ‘æŸ¥çœ‹](https://stackblitz.com/edit/concent-state-inject-way?file=index.js)ã€‚
* ä¿®æ”¹å…±äº«æ•°æ®çš„æ–¹å¼çµæ´»å¤šæ ·ä¸”ç®€å•ç›´æ¥ï¼Œ[ç‚¹æˆ‘æŸ¥çœ‹](https://stackblitz.com/edit/concent-state-modify-way)ï¼›
* å¯¹ç»„ä»¶æ‰©å±•äº†äº‹ä»¶æ€»çº¿ã€computedã€watchã€åŒå‘ç»‘å®šç­‰ç‰¹æ€§ï¼Œ[ç‚¹æˆ‘æŸ¥çœ‹](https://stackblitz.com/edit/concent-vue-like-programming)ï¼›
* å†…ç½®ä¸react16ä¸€æ ·çš„ä½¿ç”¨æ–¹å¼ä½†å´æ›´æœ‰è¶£çš„hookï¼Œ[ç‚¹æˆ‘æŸ¥çœ‹](https://stackblitz.com/edit/concent-hook?file=index.js)ï¼›
* é»˜è®¤é‡‡ç”¨åå‘ç»§æ‰¿åŒ…è£¹ä½ çš„ç»„ä»¶ï¼Œè®©react dom treeå±‚çº§æ›´å°‘ï¼Œä¿æŒå¹²å‡€å’Œæ¸…çˆ½ï¼›
* åŸºäºå¼•ç”¨å®šä½å’ŒçŠ¶æ€å¹¿æ’­ï¼Œæ”¯æŒç»†ç²’åº¦çš„çŠ¶æ€è®¢é˜…ï¼Œæ¸²æŸ“æ•ˆç‡å‡ºä¼—ï¼Œ[ç‚¹æˆ‘æŸ¥çœ‹](https://stackblitz.com/edit/concent-why-it-is-high-performance?file=index.js)ï¼›
* æ”¯æŒä¸­é—´ä»¶ï¼Œå¯ä»¥æ‰©å±•ä½ çš„ä¸ªæ€§åŒ–æ’ä»¶å¤„ç†æ•°æ®å˜æ›´ï¼Œ[ç‚¹æˆ‘æŸ¥çœ‹](https://stackblitz.com/edit/concent-middleware?file=index.js)ï¼›
* æ”¯æŒreact 0.10+ä»»æ„ç‰ˆæœ¬ï¼›

## æ­é…react-routerä½¿ç”¨
è¯·ç§»æ­¥é˜…è¯»å’Œäº†è§£[react-router-concent](https://github.com/concentjs/react-router-concent)ï¼Œæ­é…ä½¿ç”¨éå¸¸çš„ç®€å•å’Œå®¹æ˜“ã€‚

___
## ğŸ“¦ å¿«é€Ÿå¼€å§‹
ç¡®ä¿ä½ æœ¬åœ°æœºå™¨ä¸Šå®‰è£…æœ‰[nodejs](http://nodejs.cn/download/)ã€‚
### åˆ›å»ºä¸€ä¸ªapp
åœ¨ä½ çš„ç”µè„‘ä¸Šï¼Œé€‰æ‹©ä¸€ä¸ªåˆé€‚çš„ç›®å½•å¹¶è¿›å…¥ï¼Œä½¿ç”¨[create-react-app](https://github.com/facebookincubator/create-react-app) åˆ›å»ºä¸€ä¸ªapp
```sh
$ npm i -g create-react-app
$ create-react-app cc-app
```
### å®‰è£…cc
åˆ›å»ºå¥½appåï¼Œè¿›å…¥ä½ çš„appæ ¹ç›®å½•ï¼Œä½¿ç”¨npmå®‰è£…`concent`
```sh
$ cd cc-app
$ npm i --save concent
```
æˆ–è€…ä½¿ç”¨yarnå®‰è£…
```sh
$ yarn add concent
```

### æ–°æ‰‹counterç¤ºä¾‹
å°†ä»¥ä¸‹ä»£ç å¤åˆ¶ç²˜è´´åˆ°`cc-app`ç›®å½•ä¸‹çš„`src/App.js`æ–‡ä»¶é‡Œ(æ³¨ï¼šæ˜¯å®Œå…¨è¦†ç›–æ‰åŸæ¥çš„å†…å®¹)ã€‚

```javascript
import React, { Component, Fragment } from 'react';
import { register, run } from 'concent';

//è¿è¡Œconcentï¼Œè½½å…¥æ¨¡å—é…ç½®
run({
  counter: {//å®šä¹‰counteræ¨¡å—
    state: {//å®šä¹‰state
      count: 0,
    },
    reducer: {
      inc(payload, moduleState) {
        return { count: moduleState.count + 1 };
      },
      dec(payload, moduleState) {
        return { count: moduleState.count - 1 };
      }
    }
  }
})

//å®šä¹‰ç±»ç»„ä»¶
class Counter extends Component {
  //setState èƒ½å¤Ÿå°†æ•°æ®å°†åŒæ­¥åˆ°storeï¼Œå¹¿æ’­åˆ°å…¶ä»–å®ä¾‹
  inc = () => {
    this.setState({ count: this.state.count + 1 });
  }
  dec = () => {
    this.setState({ count: this.state.count - 1 });
  }
  //è°ƒç”¨dispatch, åŒæ ·çš„èƒ½å¤Ÿå°†æ•°æ®å°†åŒæ­¥åˆ°storeï¼Œå¹¿æ’­åˆ°å…¶ä»–å®ä¾‹
  incD = () => {
    this.$$dispatch('inc');
  }
  decD = () => {
    this.$$dispatch('dec');
  }
  render() {
    //concentæ³¨å…¥counteræ¨¡å—çš„æ•°æ®åˆ°state
    const { count } = this.state;
    return (
      <div style={{ padding: '12px', margin: '6px' }}>
        <div>count: {count}</div>
        <button>inc by setState</button>
        <button>dec by setState</button>
        <br />
        <button>inc by dispatch</button>
        <button>dec by dispatch</button>
      </div>
    );
  }
}
//æ³¨å†Œæˆä¸ºå±äºcounteræ¨¡å—çš„åå­—ä¸ºCounter ccç±»
const CcCounter_ = register('Counter', 'counter')(Counter);

function App() {
  return (
    <Fragment>
      <CcCounter_ />
      <CcCounter_ />
    </Fragment>
  )
}

export default App;
```

### è¿›é˜¶counterç¤ºä¾‹
å°†ä»¥ä¸‹ä»£ç å¤åˆ¶ç²˜è´´åˆ°`cc-app`ç›®å½•ä¸‹çš„`src/App.js`æ–‡ä»¶é‡Œ(æ³¨ï¼šæ˜¯å®Œå…¨è¦†ç›–æ‰åŸæ¥çš„å†…å®¹)ã€‚
ç„¶åæ‰§è¡Œ`npm start`è¿è¡Œèµ·æ¥ï¼Œåœ¨æµè§ˆå™¨é‡Œå¼€å§‹ä½“éªŒ`cc`çš„ç¥å¥‡æ•ˆæœå§ã€‚
> æ¢ç´¢concentä»è¿™é‡Œå¼€å§‹ï¼Œ[ç‚¹æˆ‘çœ‹ä»¥ä¸‹ä»£ç çš„åœ¨çº¿ç¤ºä¾‹](https://stackblitz.com/edit/concent-quick-start?file=index.js)

```javascript
import React, {Component} from 'react';
import cc, { register, run, CcFragment } from 'concent';

const sleep = (ms=2000) => new Promise(resolve=> setTimeout(resolve, ms));

//å®šä¹‰ä¸¤ä¸ªæ¨¡å—ï¼Œfoo å’Œ counter
run({
  foo:{
    state:{//å®šä¹‰state
      age:1,
      name:'concent',
      info:{
        addr:'Beijing',
      }
    }
  },
  counter:{
    state:{//å®šä¹‰state
      count:0,
      loading: '',
    },
    watch:{//å®šä¹‰watchï¼Œå½“countå€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè§¦å‘æ­¤å‡½æ•°æ‰§è¡Œ
      count(val){
        if(val==='love'){
          cc.setState('foo',{name:'now counter/count is '+val});//ç”¨ccé¡¶å±‚apiä¿®æ”¹fooæ¨¡å—çš„æ•°æ®
        }else{
          cc.setState('foo',{name:'try input love'});
        }
      }
    },
    computed:{//å®šä¹‰computedï¼Œå½“countå€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šè§¦å‘æ­¤å‡½æ•°è®¡ç®—ï¼Œè®¡ç®—çš„å€¼å¯ä»¥åœ¨å®ä¾‹é‡Œçš„this.$$moduleComputedä¸Šè·å¾—
      count(val){
        if(typeof val==='string') return val.split('').reverse().join('');
        else return val;
      }
    },
    reducer:{//å®šä¹‰reducerå‡½æ•°ï¼Œç”¨äºå¤„ç†ä¸šåŠ¡é€»è¾‘
      setLoading({payload:loading}){
        return {loading};
      },
      updateCount({payload:count}){
        return {count};
      },
      async uploadCount({dispatch, payload:count}){
        dispatch('setLoading', 'å‡å…®å…®çš„loading');
        await new Promise(resolve=> setTimeout(resolve, 2000));
        return {count, loading:''};
        //æˆ–è€…å†™ä¸º 
        // dispatch('setLoading', '');
        // dispatch('updateCount', count);
      }
    },
    init: async ()=>{
      await sleep(3900);
      return {count:888}
    },//å®šä¹‰initï¼Œæ¨¡æ‹Ÿä»åç«¯å¼‚æ­¥è·å–æ–°çš„åˆå§‹åŒ–æ•°æ®
  }
})

class Counter extends Component {
  render(){
    const {count, loading} = this.state;
    return (
      <div style={{padding:'12px', margin:'6px'}}>
        <p style={{color:'red'}}>{loading}</p>
        <span>reversed count: {this.$$moduleComputed.count}</span>
        <br/>
        {/** this.$$syncæä¾›åŒå‘ç»‘å®šçš„èƒ½åŠ› */}
        <input data-ccsync="count" onChange={this.$$sync} value={count}/>
      </div>
    );
  }
}
const CcCounter_ = register('Counter', {module:'counter', sharedStateKeys:'*'})(Counter);

function App(){
  return (
    <div>
      <CcCounter_ />
      <CcCounter_ />
      {/** è¿™æ˜¯ä¸€ä¸ªCcFragmentï¼Œå¯ä»¥å¿«é€Ÿè¿æ¥storeï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒconcentä¸“é—¨ä¸ºCcFragmentå®ç°å¾—hookå‡½æ•°, stateæ˜¯è‡ªå·±çš„state */}
      <CcFragment state={{ a: 1, b: 2, c: { c1: 'c1', c2: 'c2' } }} connect={{ 'foo': '*', 'counter': '*' }} render={(params) => {
        const {state, setState, connectedState, connectedComputed, hook, dispatch, sync} = params;

        //CcFragmentå®ä¾‹é‡Œhookç»´æŠ¤çš„å±€éƒ¨state
        const [localCount='', setCount] = hook.useState();
        const [localAge='', setAge] = hook.useState('age');

        const {a, b, c} = state;//CcFragmentå®ä¾‹è‡ªå·±çš„å±€éƒ¨state

        hook.useEffect(()=>{
          alert('CcFragmentæŒ‚è½½å®Œæ¯•');
          return ()=>console.log('CcFragmentå¸è½½çš„æ—¶å€™æ‰ä¼šæ‰§è¡Œè¿™ä¸ªæ¸…ç†å‡½æ•°');
        },[]);//ç¬¬äºŒä½å‚æ•°æ˜¯ç©ºæ•°ç»„ï¼Œè®©è¿™ä¸ªå‰¯ä½œç”¨åªä¼šåœ¨CcFragmentæŒ‚è½½å®Œæ¯•æ‰§è¡Œä¸€æ¬¡è€Œå·²
        return (
          <div>
            <h3>count: {connectedState.counter.count}</h3>
            <h3>age: {connectedState.foo.age}</h3>
            <h3>name: {connectedState.foo.name}</h3>
            <p>
              è¾“å…¥count:<input value={localCount} onChange={e=>setCount(e.currentTarget.value)} />
              {/** ç›´æ¥é€šè¿‡dispatchå¥æŸ„æ¥è°ƒç”¨counteræ¨¡å—çš„uploadCountå‡½æ•° */}
              <button onClick={()=>dispatch('counter/uploadCount', localCount)}>ç‚¹å‡»ç¡®è®¤ï¼Œä¿®æ”¹fooæ¨¡å—é‡Œçš„count</button>
            </p>

            <p>
              {/** hookçš„setterè‡ªåŠ¨å®ç°äº†åŒå‘ç»‘å®š */}
              localAge:<input value={localAge} onChange={setAge} />
            </p>

            <p>
              setStateä¿®æ”¹æœ¬åœ°è½¬æ€ï¼š
              {/** ä½¿ç”¨setStateå¥æŸ„ä¿®æ”¹å±€éƒ¨stateçŠ¶æ€ */}
              <input value={a} onChange={e=>setState({a:e.currentTarget.value})}/>
            </p>

            <p>
              syncåŒå‘ç»‘å®šæœ¬åœ°çŠ¶æ€ï¼š
              {/** ä½¿ç”¨syncå¥æŸ„è‡ªåŠ¨åŒæ­¥è½¬æ€ï¼Œdata-ccsyncé‡Œçš„keyä¸åŠ æ¨¡å—å‰ç¼€çš„è¯ï¼Œccåªä¼šå°†å’Œå€¼åŒæ­¥åˆ°å®ä¾‹æœ¬åœ°çŠ¶æ€é‡Œ */}
              <input data-ccsync="b" value={b} onChange={sync}/>
            </p>
            <p>
              c1:<input data-ccsync="c.c1" value={c.c1} onChange={sync}/>
              c2:<input data-ccsync="c.c2" value={c.c2} onChange={sync}/>
            </p>

            <p>
              syncåŒå‘ç»‘å®šæ¨¡å—çŠ¶æ€ï¼š
              {/** ä½¿ç”¨syncå¥æŸ„è‡ªåŠ¨åŒæ­¥è½¬æ€ï¼Œdata-ccsyncé‡Œçš„keyåŠ äº†æ¨¡å—åå‰ç¼€fooï¼Œccä¼šå¹¿æ’­è¿™ä¸ªçŠ¶æ€åˆ°å…¶ä»–å®ä¾‹ */}
              <input data-ccsync="foo/age" value={connectedState.foo.age} onChange={sync}/>
            </p>
            <p>
              ä¿®æ”¹fooæ¨¡å—ä¸‹çš„addrå€¼:
              <input data-ccsync="foo/info.addr" value={connectedState.foo.info.addr} onChange={sync}/>
            </p>

          </div>
        )
      }}/>
    </div>
  );
}

export default App;
```

### [0å…¥ä¾µï¼Œæ¸è¿›å¼å®ä¾‹](https://stackblitz.com/edit/cc-multi-ways-to-wirte-code?file=index.js)

___
## ğŸ”¨æ›´å¤šç²¾å½©ç¤ºä¾‹
### [stackblitzåœ¨çº¿ç»ƒä¹ ç¤ºä¾‹é›†åˆ](https://stackblitz.com/@fantasticsoul)
### [ccç‰ˆæœ¬çš„ant-design-pro](https://github.com/fantasticsoul/rcc-antd-pro)
### [ä¸€ä¸ªç›¸å¯¹å®Œæ•´çš„ç¤ºä¾‹](https://stackblitz.com/edit/cc-awesome)
### [æœ‰è¶£çš„counter](https://stackblitz.com/edit/funny-counter)
### [å¢å¼ºçš„counter](https://stackblitz.com/edit/dva-example-count-1saxx8)
### [Jsrun playground](http://jsrun.net/fLXKp/play) 
### [Jsrun video](http://jsrun.net/vLXKp/play)
### [ç¤ºä¾‹é›†åˆ](https://github.com/fantasticsoul/rcc-simple-demo)
___
## å›¾æ–‡ä»‹ç»
### ccæ¸²æŸ“æµç¨‹
![](https://raw.githubusercontent.com/concentjs/concent-site/master/img/cc-core.png)
### ccç»„ä»¶å·¥ä½œæµç¨‹
![](https://raw.githubusercontent.com/concentjs/concent-site/master/img/cc-process.png)

### [concentæ˜¯ä»€ä¹ˆ](https://concentjs.github.io/concent-site/docs/doc-intro-what-is-concent)
### [åœ¨ccé‡Œç”¨classå’Œfunctionå®ç°counter](https://juejin.im/post/5c8f77bdf265da60ec2812f7)
### [èŠä¸€èŠccçš„å˜åŒ–ä¾¦æµ‹å’Œhookå®ç°](https://juejin.im/post/5c8d99f4e51d4555816d6335)
### [åœ¨ccé‡Œç©è½¬æ— çŠ¶æ€ç»„ä»¶](https://juejin.im/post/5c838107f265da2dca389593)
### [å¯¹è¯ redux(å®¶æ—)ï¼Œåç”Ÿä½•ä»¥æŒ‘æˆ˜å‰è¾ˆï¼Ÿ](https://juejin.im/post/5c8479316fb9a049ba42635c)
### [ä¸ºä»€ä¹ˆä¸ç”¨redux](https://www.zhihu.com/question/263928256/answer/274963347)
